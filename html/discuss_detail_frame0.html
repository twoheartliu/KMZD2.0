<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="copyright" content="www.apicloud.com" />
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <title>孔孟之道--听单评论详情</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css" />
    <style>
        html,
        body {
            min-height: 100%;
            background: #f2f2f2
        }

        .fr {
            float: right;
        }

        .fl {
            float: left;
        }

        .mt5 {
            margin-top: 5px;
        }

        .mt10 {
            margin-top: 10px;
        }

        .mt15 {
            margin-top: 15px;
        }

        .mt20 {
            margin-top: 20px;
        }

        .ml5 {
            margin-left: 0.5em;
        }

        .mr5 {
            margin-right: 0.5em;
        }

        .hdivider {
            width: 100%;
            height: 1px;
            background-color: #f2f2f2;
        }

        .br {
            border-right: 1px solid #f2f2f2;
        }

        .bb {
            border-bottom: 1px solid #f2f2f2;
            height: 1px;
        }

        .toRight {
            right: 0;
        }

        .row {
            display: -webkit-box;
            display: -webkit-flex;
        }

        .col {
            -webkit-box-flex: 1;
            -webkit-flex: 1;
            flex: 1;
            margin: 0 5px;
            position: relative;
        }

        .list_bj {
            width: 100%;
        }

        .p13px {
            padding: 0px 13px;
        }

        .single {
            height: 150px;
            border-radius: 10px;
            box-shadow: 0px 0px 5px #bbb;
            margin-top: 5px;
        }

        .single_img {
            width: 130px;
            height: 130px;
            padding: 10px;
        }

        .single_img img {
            width: 100%;
        }

        .single_l {
            padding: 10px 0;
            position: relative;
            height: 130px;
        }

        .single_h1 {
            font-size: 16px;
            padding: 5px 0;
        }

        .single_img_p_span {
            padding: 5px 0;
            overflow: hidden;
        }

        .single_div_img {
            width: 17px;
            height: 17px;
        }

        .single_div_img img {
            width: 100%;
        }

        .single_img_name {
            font-size: 12px;
            margin: 0 5px;
        }

        .single_LIVE {
            width: 37px;
            height: 14px;
        }

        .single_LIVE img {
            width: 100%;
        }

        .single_time {
            font-size: 12px;
            overflow: hidden;
            margin-top: 30px;
        }

        .playall {
            width: 100%;
            background-color: #eee;
            margin-top: 20px;
        }

        .playall_span {
            line-height: 40px;
            height: 40px;
            font-size: 14px;
            /*color:#999;*/
            color: #535354;
        }

        ul {
            margin: 0 10px;
        }

        ul li {
            width: 100%;
            padding: 10px 0;
            border-bottom: 1px solid #ccc;
        }

        .user-img {
            width: 50px;
            height: 50px;
            line-height: 50px;
            display: inline-block;
        }

        .user-img img {
            width: 45px;
            height: 45px;
        }

        .user-name {
            display: inline-block;
            vertical-align: top;
            position: relative;
            width: 83%;
        }

        .user-name p {
            font-size: 16px;
            color: #89211b;
            line-height: 25px;
            font-size: 12px;
        }

        .user-name p:nth-child(2) {
            color: #535354;
            color: #999;
        }

        .user-name .replyCont {
            color: #535354;
            font-size: 15px;
            line-height: 22px;
        }

        .discuss {
            height: auto;
            background-color: #f2f2f3;
            color: #999;
            line-height: 20px;
        }

        .discuss span {
            color: #999;
            font-size: 14px;
        }

        .user-name p:nth-last-child(1) {
            position: absolute;
            top: 0;
            right: 0px;
            width: 50px;
        }

        .user-name p:nth-last-child(1) img {
            width: 30px;
        }

        button:focus {
            outline: none;
        }

        .clear {
            clear: both;
        }

        .sec-tit {
            height: 40px;
            line-height: 40px;
            padding-left: 8px;
        }

        .sec-discuss {
            background-color: #fff;
            padding: 8px;
            border-bottom: 1px solid #e0e0e0;
        }

        .sec-img {
            display: inline-block;
            vertical-align: top;
        }

        .sec-img img {
            width: 45px;
            height: 45px;
        }

        .sec-txt {
            display: inline-block;
        }

        .sec-txt>p {
            color: #999;
            line-height: 25px;
        }

        .sec-txt>p:nth-child(2) {
            color: #ccc;
            font-size: 13px;
        }

        .dis-right>span {
            color: #ccc;
            font-size: 12px;
        }

        .dis-right>img {
            width: 18px;
            height: 18px;
            vertical-align: middle;
        }

        .dis-txt {
            margin-left: 40px;
            padding-bottom: 10px;
            color: #535354;
        }

        .discuss {
            margin-left: 40px;
            height: auto;
            padding: 10px;
            background-color: #f2f2f3;
            color: #999;
            border-radius: 5px;
        }

        .reply {
            width: 100%;
            overflow: hidden;
        }

        .reply div {
            float: right;
        }

        #section {
            margin-bottom: 50px;
        }
    </style>
</head>

<body>
    <div class="list_bj" id="container">
        <div class="p13px">
            <div class="single">
                <div class="single_img fl"><img src="../image/index/pic.jpg" alt=""></div>
                <div class="single_l fl">
                    <div class="single_h1" id="tingdanliebiaobiaoti"></div>
                    <div class="single_img_p_span">
                        <div class="single_div_img fl"><img src="../image/KM_tx.png" alt=""></div>
                        <div class="single_img_name fl">小许</div>
                        <!-- <div class="single_LIVE fl"><img src="../image/vip/KM_live.png" alt=""></div> -->
                        <div class="clear"></div>
                    </div>
                    <div class="single_time">2017-1-12更新</div>
                </div>
                <div class="clear"></div>
            </div>
            <div class="clear"></div>
        </div>
        <div class="playall">
            <section id="section">
                <div class="sec-tit">所有评论</div>
                <div class="sec-discuss" id="comments" >

                </div>
                <!-- <div class="sec-discuss">
                    <div class="dis-left fl">
                        <div class="sec-img"><img src="../image/icon-person.png" alt=""></div>
                        <div class="sec-txt">
                            <p>燕赵门</p>
                            <p>2017年9月19日</p>
                        </div>
                    </div>
                    <div class="dis-right fr" >
                        <div class="fr" ><img src="../image/KM_ListingsListDzs.png" alt="" class="zan01"></div><div class="fr"><span>3</span></div>
                    </div>
                    <div class="clear"></div>
                    <div class="dis-txt">海中月是天上月，眼前人是心上人。向来心是看客心，奈何人是剧中人</div>
                    <div class="reply"><div  onclick="fnOpenMessageNotDetail()">回复</div></div>
                </div>
                <div class="sec-discuss">
                    <div class="dis-left fl">
                        <div class="sec-img"><img src="../image/icon-person.png" alt=""></div>
                        <div class="sec-txt">
                            <p>燕赵门</p>
                            <p>2017年9月19日</p>
                        </div>
                    </div>
                    <div class="dis-right fr">
                        <span>3</span><img src="../image/KM_ListingsListDzs.png" alt="" class="zan01">
                    </div>
                    <div class="clear"></div>
                    <div class="dis-txt">海中月是天上月，眼前人是心上人。向来心是看客心，奈何人是剧中人</div>
                    <div class="reply"><div  onclick="fnOpenMessageNotDetail()">回复</div></div>
                    <div class="discuss">
                        <span>我的评论：不知道为什么分开，很多喜欢以为永远会喜欢，到最后才发现任何事情都抵不过时过境迁。</span>
                    </div> -->

            </section>
        </div>
    </div>
</body>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/common.js"></script>
<script type="text/javascript">
    var token;
    var albumId;
    var uris;
    var commentaAlbumGoodHtml;
    var commentExtraGoods;

    apiready = function() {
        token = $api.getStorage('token');

        albumId = api.pageParam.albumId;
        uris = api.pageParam.uris;
        ListenToTheListOfComments();
        api.addEventListener({
            name: 'gengXin'
        }, function(ret, err) {
            ListenToTheListOfComments();
        });
    }

    function ListenToTheListOfComments() {
        api.ajax({
            url: host + apiUri + uris + albumId,
            method: 'get',
            dataType: 'json',
            headers: {
                "source": api.systemType,
                "version": version,
                "session": token
            }
        }, function(ret, err) {
            if (ret.status == 200) {
                var stylelist = $api.byId('comments');
                var html = '';
                for (var i = 0; i < ret.data.length; i++) {
                    var date = new Date(ret.data[i].create_date * 1000); //时间戳为10位需*1000，时间戳为13位的话不需乘1000
                    Y = date.getFullYear() + '年';
                    M = (date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1) + '月';
                    D = (date.getDate() < 10 ? '0' + (date.getDate()) : date.getDate()) + '日';
                    // h = date.getHours() + ':';
                    // m = date.getMinutes() + ':';
                    // s = date.getSeconds();
                    // return Y+M+D+h+m+s;
                    var dates = Y + M + D;
                    commentExtraGoods = ret.data[i].good_total;
                    if (ret.data[i].re_nick_name) {
                        html += '<div class="dis-left fl"><div class="sec-img">';
                        if(ret.data[i].photo){
                          html += '<img src="'+ret.data[i].photo+'" alt="">';
                        }else{
                          html += '<img src="../image/KM_tx.png" alt="">';
                        }
                        html += '</div><div class="sec-txt"><p>'+ret.data[i].nick_name+'</p><p>' + dates +
                            '</p></div></div><div class="dis-right fr"><div class="fr" id="commentExtraGood'+ret.data[i].comment_id+'"  class="collectmusicFxs">';
                            var commentaAlbumss = $api.getStorage('commentaAlbumExtraGood'+ret.data[i].comment_id+'');
                            // console.log(commentaAlbumss);
                            if(!commentaAlbumss){
                              html += '<img src="../image/KM_ListingsListDzs.png" alt="" id="'+ret.data[i].comment_id+'" class="collectmusicFxs" onclick="collectmusicFx(this)" data-click="0">';

                            }else{
                              if(commentaAlbumss != 'inc'){
                                html += '<img src="../image/KM_ListingsListDzs.png" alt="" id="'+ret.data[i].comment_id+'" class="collectmusicFxs" onclick="collectmusicFx(this)" data-click="0">';
                              }else{
                                html += '<img src="../image/KM_play_dianzan_red.png" alt="" id="'+ret.data[i].comment_id+'" class="collectmusicFxs" onclick="collectmusicFx(this)" data-click="1">';
                              }
                            }
                        html += '</div><div class="fr"><span id="corner_mark'+ret.data[i].comment_id+'">'+ret.data[i].good_total +'</span></div></div><div class="clear"></div><div class="dis-txt">'+ret.data[
                                i].content +'</div><div class="reply"><div  onclick="fnOpenMessageNotDetail('+ret.data[i].comment_id+')">回复</div></div><div class="discuss"><span>'+ret.data[i].re_nick_name+':'+ret.data[i].re_content+
                            '</span></div>';
                    } else {
                        html += '<div class="dis-left fl"><div class="sec-img">';
                        if(ret.data[i].photo){
                          html += '<img src="'+ret.data[i].photo+'" alt="">';
                        }else{
                          html += '<img src="../image/KM_tx.png" alt="">';
                        }
                        html += '</div><div class="sec-txt"><p>'+ret.data[i].nick_name+'</p><p>' + dates +
                            '</p></div></div><div class="dis-right fr"><div class="fr" id="commentExtraGood'+ret.data[i].comment_id+'" class="collectmusicFxs">';
                            var commentaAlbumss = $api.getStorage('commentaAlbumExtraGood'+ret.data[i].comment_id+'');
                            // console.log(commentaAlbumss);
                            if(!commentaAlbumss){
                              html += '<img src="../image/KM_ListingsListDzs.png" alt="" id="'+ret.data[i].comment_id+'" class="collectmusicFxs" onclick="collectmusicFx(this)" data-click="0">';
                            }else{
                              if(commentaAlbumss != 'inc'){
                                html += '<img src="../image/KM_ListingsListDzs.png" alt="" id="'+ret.data[i].comment_id+'" class="collectmusicFxs" onclick="collectmusicFx(this)" data-click="0">';
                              }else{
                                html += '<img src="../image/KM_play_dianzan_red.png" alt="" id="'+ ret.data[i].comment_id+'" class="collectmusicFxs" onclick="collectmusicFx(this)" data-click="1">';
                              }
                            }
                        html +=  '</div><div class="fr"><span id="corner_mark'+ret.data[i].comment_id+'">'+ret.data[i].good_total+'</span></div></div><div class="clear"></div><div class="dis-txt">'+ret.data[
                                i].content+'</div><div class="reply"><div  onclick="fnOpenMessageNotDetail('+ret.data[i].comment_id+')">回复</div></div>';
                    }
                  $api.html(stylelist, html);
                }
            } else {
                alert(JSON.stringify(err));
                alert(ret.message);
                // $api.rmStorage('token');
                // api.openWin({
                //     name: 'login',
                //     url: '../login.html',
                //     pageParam: {
                //         name: 'test'
                //     }
                // });
            }
        });
    }

    function collectmusicFx(clicktoolitem) {

        var img_id = clicktoolitem.getAttribute("id");

        var toolbarlist = document.getElementById(img_id);
        var click = toolbarlist.getAttribute("data-click");
        var stylelist = $api.byId('corner_mark'+img_id+'');
        var conner_num = parseInt(stylelist.innerText);
        if (click == 0) {
          // 点开

          uri = '/extra/good';
          api.ajax({
              url: host + apiUri + uri + '/' + img_id,
              method: 'post',
              dataType: 'json',
              headers: {
                  "source": api.systemType,
                  "version": version,
                  "session": token
              },
              data:{
                values:{
                  "type":'inc',
                  "model":'album_c',
                },
              },
          }, function(ret, err) {
              if (ret.status == 200) {
                toolbarlist.setAttribute("data-click", 1);
                toolbarlist.src = "../image/KM_play_dianzan_red.png";
                  api.toast({              
                      msg:   '已点赞',
                      duration:  2000,
                      location:   'middle'          
                  });

                  conner_num++;
                  $api.html(stylelist, conner_num);
                  $api.setStorage('commentaAlbumExtraGood'+img_id+'','inc');
                  // $api.rmStorage('commentaAlbumExtraGood'+img_id+'');
              } else {
              //   api.toast({              
              //       msg:  ret.message,
              //       duration:  2000,
              //       location:   'middle'          
              //   });
              //     $api.rmStorage('token');
              //     api.openWin({
              //         name: 'login',
              //         url: '../login.html',
              //     });
              }
          });
        } else {
          // 关闭

          uri = '/extra/good';
          api.ajax({
              url: host + apiUri+uri+'/'+img_id,
              method: 'post',
              dataType: 'json',
              headers: {
                  "source": api.systemType,
                  "version": version,
                  "session": token
              },
              data:{
                values:{
                  "type":'dec',
                  "model":'album_c',
                }
              }
          }, function(ret, err) {
              if (ret.status == 200) {
                toolbarlist.setAttribute("data-click", 0);
                toolbarlist.src = "../image/KM_ListingsListDzs.png";
                  api.toast({              
                      msg:   '已取消点赞',
                      duration:  2000,
                      location:   'middle'          
                  });
                  conner_num--;
                  if(conner_num<0){
                    conner_num = 0;
                  }
                  $api.html(stylelist, conner_num);
                  $api.setStorage('commentaAlbumExtraGood'+img_id+'','dec');
              } else {
                // api.toast({              
                //     msg:  ret.message,
                //     duration:  2000,
                //     location:  'middle'          
                // });
                  // $api.rmStorage('token');
                  // api.openWin({
                  //     name: 'login',
                  //     url: '../login.html',
                  // });
              }
          });
        }
    }

    function fnOpenMessageNotDetail(comment_id) {
        api.openWin({
            name: 'replyDetail',
            url: './reply_detail.html',
            pageParam: {
                comment_id: comment_id,
                albumId: albumId,
                uris: uris
            },
            bounces: false,
            vScrollBarEnabled: true,
            hScrollBarEnabled: true
        });
    }
</script>

</html>
