<!DOCTYPE HTML>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no" />
    <title>播放</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css" />
    <link rel="stylesheet" href="../css/swiper.min.css">
    <style>
        html,
        body {
            overflow: hidden;
            background: url(../image/play/play_bg_tra.jpg) no-repeat;
            background-size: 100% 100%;
        }

        .clear {
            clear: both;
        }

        #wrap {
            -webkit-background-size: cover;
            background-size: cover;
            display: -webkit-box;
            display: -webkit-flex;
            display: flex;
            -webkit-box-orient: vertical;
            -webkit-flex-flow: column;
            flex-flow: column;
        }

        #main {
            position: relative;
            -webkit-box-flex: 1;
            -webkit-flex: 1;
            flex: 1;
        }
        /*header {
            display: -webkit-box;
            display: -webkit-flex;
            display: flex;
            height: 50px;
        }

        header div {
            font-size: 14px;
            color: #fff;
            text-align: center;
            line-height: 49px;
            -webkit-box-flex: 1;
            -webkit-flex: 1;
            flex: 1;
        }

        header i {
            display: block;
            width: 53px;
            height: 49px;
            margin-top: 5px;
        }

        header .back {
            background: url(../image/icon_back.png) no-repeat;
            background-size: 40%;
            -webkit-background-size: contain;
            background-size: contain;
        }

        header .more {
            background: url() no-repeat;
            -webkit-background-size: contain;
            background-size: contain;
        }*/

        header {
            height: 50px;
            background-color: transparent;
            /*overflow: hidden;*/
        }

        .egret-img {
            display: block;
            float: left;
            /*padding-left: 18px;*/
            width: 45px;
            height: 50px;
        }

        .egret-imgs {
            display: block;
            float: right;
            width: 45px;
            height: 50px;
            /*padding-left: 18px;*/
        }

        .egret-img img {
            width: 15px;
            height: 20px;
            padding: 15px;
        }

        .egret-txt {
            display: block;
            margin: 0 auto;
            width: 75%;
            color: #fff;
            text-align: center;
            line-height: 50px;
            height: 50px;
            font-size: 16px;
            /*vertical-align: top;*/
        }

        .header_fr {
            width: 30px;
            height: 30px;
            padding: 10px 20px 10px 10px;
            line-height: 30px;
            font-size: 15px;
            color: #fff;
            position: absolute;
            right: 5px;
            bottom: -0px;
            /*display: inline-block;*/
            /*display: none;*/
        }

        .header_fr img {
            width: 100%;
        }

        #action {
            margin-bottom: 10px;
            display: -webkit-box;
            display: -webkit-flex;
            display: flex;
        }

        #action>li {
            text-align: center;
            color: #cbcbcb;
            font-size: 12px;
            -webkit-box-flex: 1;
            -webkit-flex: 1;
            flex: 1;
            /*height:70px;*/
            /*padding-top: 30px;*/
            background-position: center top;
            background-repeat: no-repeat;
            -webkit-background-size: 25px;
            background-size: 25px;
            position: relative;
        }

        #action li>img {
            width: 25px;
        }

        #action li>i {
            position: absolute;
            top: -2px;
            right: 30%;
            width: 10px;
            height: 10px;
            display: inline-block;
            font-style: normal;
            font-size: 12px;
            color: #fff;
        }

        #control {
            /*background-color: #672d32;*/
            /*height: 100%;*/
        }

        #slider {
            height: 50px;
            position: relative;
            /*line-height: 15px;*/
        }

        #slider span {
            position: absolute;
            bottom: 0;
            font-size: 12px;
            color: #ccc;
        }

        #slider .s {
            left: 10px;
        }

        #slider .e {
            right: 10px;
        }

        #panel {
            display: -webkit-box;
            display: -webkit-flex;
            display: flex;
            padding: 30px 0 40px;
        }

        #panel li {
            width: 30px;
            height: 30px;
            -webkit-box-flex: 1;
            -webkit-flex: 1;
            flex: 1;
            background-position: center;
            background-repeat: no-repeat;
            -webkit-background-size: 30px;
            background-size: 30px;
        }

        #panel .list {
            background-image: url(../image/play/ic_play_schedule.png);
            -webkit-background-size: 25px;
            background-size: 25px;
        }

        #panel .list.focus {
            background-image: url(../image/play/ic_play_schedule_s.png);
        }

        #panel .prev {
            background-image: url(../image/play/ic_play_pre.png);
        }

        #panel .prev.focus {
            background-image: url(../image/play/ic_play_pre_s.png);
        }
        /*#panel .play {
            background-image: url(../image/play/ic_play_play.png);
        }

        #panel .play.focus {
            background-image: url(../image/play/ic_play_play_s.png);
        }*/

        #panel .pause {
            background-image: url(../image/play/ic_play_pause.png);
        }

        #panel .pause.focus {
            background-image: url(../image/play/ic_play_pause_s.png);
        }

        #panel .buffer {
            background-image: none;
        }

        @-webkit-keyframes rotate {
            from {
                -webkit-transform: rotate(0deg);
            }
            to {
                -webkit-transform: rotate(360deg);
            }
        }

        @keyframes rotate {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        #panel .buffer:before {
            content: '';
            display: inline-block;
            width: 100%;
            height: 100%;
            background: url(../image/play/ic_play_buffer.png) no-repeat center;
            -webkit-background-size: contain;
            background-size: contain;
            -webkit-animation: rotate 4s linear infinite;
            animation: rotate 4s linear infinite;
        }

        #panel .buffer.focus {
            background-image: url(../image/img/ic_play_buffer_s.png);
        }

        #panel .next {
            background-image: url(../image/play/ic_play_next.png);
        }

        #panel .next.focus {
            background-image: url(../image/img/ic_play_next_s.png);
        }

        #panel .download {
            background-image: url(../image/play_choice.png);
        }

        #panel .download.focus {
            background-image: url(../image/play_choice.png);
        }

        #chat {
            overflow: hidden;
            border-top: 1px solid #845253;
        }

        #chat a {
            float: right;
            padding: 10px;
            font-size: 12px;
            color: #ccc;
        }

        #main .wrap {
            position: absolute;
            margin: auto;
            width: 100%;
            bottom: 0;
            top: 0;
            height: 60px;
        }

        #main h1 {
            font-size: 20px;
            color: #fff;
            text-align: center;
        }

        #main label {
            display: block;
            text-align: center;
            font-size: 14px;
            color: #ccc;
            padding-top: 20px;
        }
        /*轮播图        */

        .swiper-container {
            width: 100%;
            text-align: center;
            height: 250px;
            margin-top: 75px;
        }

        .swiper-container img {
            width: 240px;
            /*margin-top: 50px;*/
        }

        #secHeader {
            width: 100%;
            height: 50px;
            background: rgba(0, 0, 0, 0.3);
            background-repeat: no-repeat;
            background-size: 100% 100%;
            overflow: hidden;
        }

        .swiper-slide .play-txt p {
            color: #fff;
            text-align: left;
            font-size: 15px;
            padding: 5px;
        }

        .play-list p {
            color: #fff;
            text-align: left;
            padding: 5px;
        }

        .swiper-slide {
            overflow: auto;
        }

        .play-txt,
        .play-list {
            padding: 0 50px;
        }

        input[type=range] {
            -webkit-appearance: none;
            width: 63%;
            border-radius: 10px;
            display: block;
            margin: 0 auto;
            position: absolute;
            bottom: 4px;
            left: 18%;
            height: 5px;
            /*这个属性设置使填充进度条时的图形为圆角*/
            /*background: -webkit-linear-gradient(#059CFA, #059CFA) no-repeat;*/
            /*background: -webkit-linear-gradient(#059CFA, #059CFA) no-repeat;*/
            /*background-size: 0% 100%;*/
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 15px;
            width: 15px;
            margin-top: -5px;

            margin-left: 0.5px;
            /*margin-right: -5px*/
            /*使滑块超出轨道部分的偏移量相等*/
            background: #ffffff;
            border-radius: 50%;
            /*外观设置为圆形*/
            border: solid 0.025em rgba(205, 224, 230, 0.5);
            /*border: solid 0.1em blue;*/
            /*设置边框*/
            box-shadow: 0 .025em .025em #3b4547;
            /*添加底部阴影*/
        }

        input[type=range]:focus {
            outline: none;
        }

        input[type=range]::-webkit-slider-runnable-track {
            height: 5px;
            border-radius: 2.5px;
            /*将轨道设为圆角的*/
            /*box-shadow: 0 1px 1px #def3f8, inset 0 .125em .125em #0d1112;*/
            /*轨道内置阴影效果*/
        }

        input[type=range]::-ms-fill-lower {
            /*进度条已填充的部分*/
            height: 15px;
            border-radius: 5px;
            /*background: linear-gradient(to right, #ff0000, #1abc9c 100%, #123);*/
            /*background: red !important;*/
        }

        input[type=range]::-ms-fill-upper {
            /*进度条未填充的部分*/
            height: 15px;
            /*border-radius: 10px;*/
            background: #ffffff;
        }

        input[type=range]:focus::-ms-fill-lower {
            background: linear-gradient(to right, #059CFA, white 100%, white);
        }

        input[type=range]:focus::-ms-fill-upper {
            background: #ffffff;
        }

        input[type=range]::-moz-range-progress {
            /*background: linear-gradient(to right, #059CFA, white 100%, white);*/
            height: 5px;
            /*border-radius: 5px;*/
        }

        .red {
            background: #89211b;
        }

        #player {
            display: block;
            margin: 0 auto;
        }
        .ImgGif{position: absolute;top: calc((100%)/2 + 6px); left: 18%;z-index: 99999;}
        /*.ImgGif img{width: 100px;height: 100px;}*/
        .loading{
            width: 300px;
            /*height: 15px;*/
            margin: 0 auto;
            /*margin-top:100px;*/
        }
        #ImgGif .loading span{
            display: inline-block;
            position: relative;
            width: 4px;
            height: 4px;
            /*height: 100%;*/
            margin-right: 5px;
            border-radius: 50%;
            background: #999;
            -webkit-animation: load 4s ease infinite;
            margin-left: 10px;
            opacity: 0;
        }

        #ImgGif .loading span:last-child{
            margin-right: 0px;
        }
        @-webkit-keyframes load{
            0%{
                opacity: 1;
            }
            100%{
                opacity: 0;
            }
        }
        #ImgGif .loading span:nth-child(1){
            -webkit-animation-delay:0.1s;
        }
        #ImgGif .loading span:nth-child(2){
            -webkit-animation-delay:0.4s;
        }
        #ImgGif .loading span:nth-child(3){
            -webkit-animation-delay:0.7s;
        }
        #ImgGif .loading span:nth-child(4){
            -webkit-animation-delay:1s;
        }
        #ImgGif .loading span:nth-child(5){
            -webkit-animation-delay:1.3s;
        }
        #ImgGif .loading span:nth-child(6){
            -webkit-animation-delay:1.6s;
        }
        #ImgGif .loading span:nth-child(7){
            -webkit-animation-delay:1.9s;
        }
        #ImgGif .loading span:nth-child(8){
            -webkit-animation-delay:2.2s;
        }
        #ImgGif .loading span:nth-child(9){
            -webkit-animation-delay:2.5s;
        }
        #ImgGif .loading span:nth-child(10){
            -webkit-animation-delay:2.8s;
        }
        #ImgGif .loading span:nth-child(11){
            -webkit-animation-delay:3.1s;
        }
        #ImgGif .loading span:nth-child(12){
            -webkit-animation-delay:3.4s;
        }
        #ImgGif .loading span:nth-child(13){
            -webkit-animation-delay:3.7s;
        }
        #ImgGif .loading span:nth-child(14){
            -webkit-animation-delay:4s;
        }
        #ImgGif .loading span:nth-child(15){
            -webkit-animation-delay:4.3s;
        }
        #ImgGif .loading span:nth-child(16){
            -webkit-animation-delay:4.6s;
        }

    </style>
</head>

<body>
    <!-- <header class="qx" id="secHeader">
      <i class="back" tapmode onclick="api.closeWin();"></i>
      <div id="title">

      </div>
      <i class="more"></i>
  </header> -->
    <header id="secHeader" class="clear">
        <div class="egret-img"><img src="../image/icon_back.png" alt="" onclick="api.closeWin();"></div>
        <div class="egret-txt" id="title">
        </div>
        <div class="header_fr" id="headerFr">
          <div onclick="fnOpenPlayShare();">
              <img src="../image/KM__play_share.png" alt="">
          </div>
        <!-- <div class="header_fr" onclick="fnOpenPlayShare(); ">
            <img src="../image/KM__play_share.png" alt="">
        </div> -->
    </header>

    <div id="wrap" class="mh">
      <!-- <div  id="loading_bgm">
          正在缓冲.....
      </div> -->
        <!-- <img src="" alt=""> -->
        <div id="main" class="qx">

            <div class="swiper-container">
                <div class="swiper-wrapper">
                    <div class="swiper-slide">
                        <img src="../image/play/poster.png" alt="">
                    </div>
                    <div class="swiper-slide">
                        <div class="play-txt">
                            <p id="geci"></p>
                            <!-- <p>无所往，其来复吉；</p> -->
                        </div>
                    </div>
                    <!-- <div class="swiper-slide">
                        <div class="play-list" id="sousuoliebiao">
                            <p>1152 周易上经 乾卦第一.mp3</p>
                        </div>
                    </div> -->
                </div>
            </div>

        </div>
        <ul id="action" class="qx">
            <li class="collect" id="bookExtraCollectionHtml">
                <img src="../image/KM_play_collect.png" alt="" id="playCollect" class="collectmusicssss" onclick="fnOpenPlayCollect(this)" data-click="0">
                <p>收藏</p>
            </li>
            <li class="share" tapmode="focus" onclick="fnOpenAddListening(); ">
                <img src="../image/KM__play_add.png" alt="">
                <p>添加到听单</p>
            </li>
            <li class="collect" id="bookExtraGood">
                <img src="../image/KM_play_dianzan.png" alt="">
                <p>点赞</p>
            </li>
            <li class="checkin" tapmode="focus" onclick="fnOpenPlayDiscuss();">
                <!-- <img src="../image/discuss_detail.png" alt=""  > -->
                <img src="../image/KM_play_discuss.png" alt="">
                <i id="comments">0</i>
                <p>评论</p>
            </li>
            <li class="timer" tapmode="focus" onclick="fnOpenChoicePlayer();">
                <img src="../image/KM_play_choice.png" alt="">
                <p>切换国学机</p>
            </li>
        </ul>
        <div id="control" class="qx">
            <div id="slider">
                <span class="s" id="kaishijishi">
                  00:00
                </span>
                <input type="range" id="range" name="range" min="0" max="100" step="1" value="0" class="red" />
                <span class="e" id="zongshichang">
                  00:00
                </span>
                <div class="ImgGif" id="ImgGif"></div>
            </div>
            <ul id="panel">
                <li class="list" tapmode="focus" onclick="openRadioList()"></li>
                <li class="prev" tapmode="focus" onclick="fnOpenPlayershangyi()"></li>
                <li class="play" tapmode="focus" id="openplayer"><img src="../image/play/ic_play_play.png" alt="" onclick="fnOpenPlayer();" id="player"></li>
                <li class="next" tapmode="focus" onclick="fnOpenPlayerxiayi()"></li>
                <li id="imagesImg"><img src="../image/play/play_change0.png" alt="" id="img"></li>
            </ul>
        </div>
    </div>

</body>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/common.js"></script>
<script type="text/javascript" src="../script/message.js"></script>
<script type="text/javascript" src="../script/swiper.min.js"></script>
<script type="text/javascript" src="../script/zepto.js"></script>
<script type="text/javascript" src="../script/audio2.js"></script>
<script type="text/javascript" src="../script/wxfx.js"></script>
<script type="text/javascript">
    var radios = ['see_you_again', 'new_soul', 'i_am_you'];
    var playlistid;
    var dqbfid;
    var zongJindu;
    var dangqianbofangid;
    var aa;
    var bofangs;
    var bofang;
    var bofangmoshi;
    var Dqbofangid;
    var token;
    var bookId;
    var bookGoodHtml;
    var bookCollectionHtml;
    var collections;
    var goods;
    var soundId;
    var namesss;
    var id;
    var playgedan;
    var playUrli;
    var playUrlis;
    var header;
    var ok;
    var bofangmoshi;
    var playType;
    apiready = function() {
      token = $api.getStorage('token');
      var secHeader = $api.byId('secHeader');
      var headeris = document.querySelector('#secHeader');
      $api.fixIos7Bar(headeris);
      $api.fixStatusBar(headeris);
      $api.fixStatusBar(secHeader);
      var headerH = $api.offset(secHeader).h;
      var headerPosH = $api.offset(secHeader).h;
      header = document.querySelector('header');
      bofangmoshi = api.pageParam.bofangmoshi;
      fnBoFangMoShiId(bofangmoshi);
      fnFuCeng();

      // 获取浏览器高度
      if (window.innerHeight)
          winHeight = window.innerHeight;
      else if ((document.body) && (document.body.clientHeight))
          winHeight = document.body.clientHeight;
      var messageFrameDiv = $api.byId('wrap');
      var winHeightHeader = winHeight - headerPosH;
      $api.css(messageFrameDiv, 'height:' + winHeightHeader + 'px;');
      $api.fixIos7Bar(header);
      fnJianTingGood();
      fnBoFangPlayType()
      // fnJianTingBFms();
      fnJianTingPingLunShu();
      ok = api.pageParam.ok;
      var oks = 'ok'+ok;
      api.addEventListener({
          name: oks
      }, function(ret, err) {
        if(ret.value.wangluo){
          fnBookExtraGoodssssss();
          dangqianbofangid = api.pageParam.DangQianbofangid;
          bofang = api.pageParam.bofang;
          playType = api.pageParam.playType;
          api.addEventListener({
              name: 'netPlaying'
          }, function(ret, err) {
              fnDangQianbofangid(ret.value.playing,ret.value.bofang);
          });
          var connectionType = api.connectionType;

            if (connectionType == "wifi") {

              if(bofang){
                // fnJinRuBofangs();
                if (dangqianbofangid) {
                  if(bofang){
                    fnJinRuBofangs(dangqianbofangid,bofang,playType);
                    soundId = dangqianbofangid;
                    bookId == dangqianbofangid;
                    fnBookExtraGoodssssss(bookId);
                    fnJianTingBookCollection(bookId);
                  }else{
                    fnJinRuBofangs(dangqianbofangid);
                    soundId = dangqianbofangid;
                    bookId == dangqianbofangid;
                    fnBookExtraGoodssssss(bookId);
                    fnJianTingBookCollection(bookId);
                  }
                } else {
                   bookId = api.pageParam.a;
                    api.addEventListener({
                        name: 'neizhiliebiaoPlaysss'
                    }, function(ret, err) {
                        listid = ret.value.playlistid;
                        playUrlis = ret.value.playUrli;
                        aa = ret.value.a;
                        bofangs = ret.value.bofang;
                        playType = ret.value.playType;
                        fnA(aa, bofangs, listid,playUrlis,playType);
                        fnAAaa(aa, bofangs, listid,playUrlis,playType);
                        bookId == aa;
                        fnBookExtraGoodssssss(bookId);
                        fnJianTingBookCollection(bookId);
                        return;
                    });
                    fnJinRuBofang();
                }
            } else {
                var dialogBox = api.require('dialogBox');
                dialogBox.alert({
                    texts: {
                        title: '您正在使用移动数据网络进行播放，是否继续播放',
                        leftBtnTitle: '暂不播放',
                        rightBtnTitle: '继续播放'
                    },
                    styles: {
                        bg: '#fff',
                        w: 300,
                        title: {
                            marginT: 20,
                            icon: 'widget://res/gou.png',
                            iconSize: 40,
                            titleSize: 14,
                            titleColor: '#666'
                        },
                        content: {
                            color: '#ccc',
                            size: 14
                        },
                        left: {
                            marginB: 7,
                            marginL: 20,
                            w: 130,
                            h: 35,
                            corner: 2,
                            bg: '#ccc',
                            color: '#FFF',
                            size: 12
                        },
                        right: {
                            marginB: 7,
                            marginL: 10,
                            w: 130,
                            h: 35,
                            corner: 2,
                            bg: '#89211b',
                            color: '#fff',
                            size: 12
                        }
                    }
                }, function(ret) {
                    if (ret.eventType == 'right') {
                        dangqianbofangid = api.pageParam.DangQianbofangid;
                        bofang = api.pageParam.bofang;
                        playType = api.pageParam.playType;
                        if (dangqianbofangid) {
                          if(bofang){
                            fnJinRuBofangs(dangqianbofangid,bofang,playType);
                            soundId = dangqianbofangid;
                            bookId == dangqianbofangid;
                            fnBookExtraGoodssssss(bookId);
                            fnJianTingBookCollection(bookId);
                          }else{
                            fnJinRuBofangs(dangqianbofangid);
                            soundId = dangqianbofangid;
                            bookId == dangqianbofangid;
                            fnBookExtraGoodssssss(bookId);
                            fnJianTingBookCollection(bookId);
                          }
                        } else {
                            api.addEventListener({
                                name: 'neizhiliebiaoPlaysss'
                            }, function(ret, err) {
                                listid = ret.value.playlistid;
                                playUrlis = ret.value.playUrli;
                                aa = ret.value.a;
                                bofangs = ret.value.bofang;
                                playType = ret.value.playType;
                                fnA(aa, bofangs, listid,playUrlis,playType);
                                fnAAaa(aa, bofangs, listid,playUrlis,playType);
                                bookId == aa;
                                fnBookExtraGoodssssss(bookId);
                                fnJianTingBookCollection(bookId);
                                return;
                            });
                            fnJinRuBofang();
                        }
                        var dialogBox = api.require('dialogBox');
                        dialogBox.close({
                            dialogName: 'alert'
                        });
                    } else if (ret.eventType == 'left') {
                        var stylelist = $api.byId('openplayer');
                        var html = '<img src="../image/play/ic_play_play.png" alt=""  id="player">';
                        $api.html(stylelist, html);
                        var dialogBox = api.require('dialogBox');
                        var stylelistkaishijishi = $api.byId('kaishijishi');
                        var htmlkaishijishi = '00:00';
                        $api.html(stylelistkaishijishi, htmlkaishijishi);
                        var stylelistzongshichang = $api.byId('zongshichang');
                        var htmlzongshichang = '00:00';
                        $api.html(stylelistzongshichang, htmlzongshichang);
                        var stylelistbookExtraGood = $api.byId('bookExtraGood');
                        var htmlbookExtraGood = '<img src="../image/KM_play_dianzan.png" alt="" class="collectmusicFxssss"><p>点赞</p>';
                        $api.html(stylelistbookExtraGood, htmlbookExtraGood);
                        var stylelistbookExtraCollectionHtml = $api.byId('bookExtraCollectionHtml');
                        var htmlbookExtraCollectionHtml = '<img src="../image/KM_play_collect.png" alt="" class="collectmusicssss" id="playCollect"  onclick="fnOpenPlayCollect(this)" data-click="0"><p>收藏</p>';
                        $api.html(stylelistbookExtraCollectionHtml, htmlbookExtraCollectionHtml);
                        var stylelistComments = $api.byId('comments');
                        var htmlComments = '0';
                        $api.html(stylelistComments, htmlComments);
                        api.closeWin();
                        dialogBox.close({
                            dialogName: 'alert'
                        });
                    }
                });
            }



        }
      }
      });

      var connectionType = api.connectionType;
      if(connectionType == "none"){
      	netWorkNone();

      }else{
        fnBookExtraGoodssssss();
        dangqianbofangid = api.pageParam.DangQianbofangid;
        bofang = api.pageParam.bofang;
        playType = api.pageParam.playType;
        api.addEventListener({
            name: 'netPlaying'
        }, function(ret, err) {
            fnDangQianbofangid(ret.value.playing,ret.value.bofang);
        });

          if (connectionType == "wifi") {
              if (dangqianbofangid) {

                if(bofang){
                  fnJinRuBofangs(dangqianbofangid,bofang,playType);
                  soundId = dangqianbofangid;
                  bookId == dangqianbofangid;
                  fnBookExtraGoodssssss(bookId);
                  fnJianTingBookCollection(bookId);
                }else{
                  fnJinRuBofangs(dangqianbofangid);
                  soundId = dangqianbofangid;
                  bookId == dangqianbofangid;
                  fnBookExtraGoodssssss(bookId);
                  fnJianTingBookCollection(bookId);
                }

              } else {
                 bookId = api.pageParam.a;
                  api.addEventListener({
                      name: 'neizhiliebiaoPlaysss'
                  }, function(ret, err) {
                      listid = ret.value.playlistid;
                      playUrlis = ret.value.playUrli;
                      playType = ret.value.playType;
                      aa = ret.value.a;
                      bofangs = ret.value.bofang;
                      fnA(aa, bofangs, listid,playUrlis,playType);
                      fnAAaa(aa, bofangs, listid,playUrlis,playType);
                      bookId == aa;
                      fnBookExtraGoodssssss(bookId);
                      fnJianTingBookCollection(bookId);
                      return;
                  });
                  fnJinRuBofang();
              }
          } else {
              var dialogBox = api.require('dialogBox');
              dialogBox.alert({
                  texts: {
                      title: '您正在使用移动数据网络进行播放，是否继续播放',
                      leftBtnTitle: '暂不播放',
                      rightBtnTitle: '继续播放'
                  },
                  styles: {
                      bg: '#fff',
                      w: 300,
                      title: {
                          marginT: 20,
                          icon: 'widget://res/gou.png',
                          iconSize: 40,
                          titleSize: 14,
                          titleColor: '#666'
                      },
                      content: {
                          color: '#ccc',
                          size: 14
                      },
                      left: {
                          marginB: 7,
                          marginL: 20,
                          w: 130,
                          h: 35,
                          corner: 2,
                          bg: '#ccc',
                          color: '#FFF',
                          size: 12
                      },
                      right: {
                          marginB: 7,
                          marginL: 10,
                          w: 130,
                          h: 35,
                          corner: 2,
                          bg: '#89211b',
                          color: '#fff',
                          size: 12
                      }
                  }
              }, function(ret) {
                  if (ret.eventType == 'right') {
                      dangqianbofangid = api.pageParam.DangQianbofangid;
                      bofang = api.pageParam.bofang;
                      playType = api.pageParam.playType;
                      if (dangqianbofangid) {


                        if(bofang){
                          fnJinRuBofangs(dangqianbofangid,bofang,playType);
                          soundId = dangqianbofangid;
                          bookId == dangqianbofangid;
                          fnBookExtraGoodssssss(bookId);
                          fnJianTingBookCollection(bookId);
                        }else{
                          fnJinRuBofangs(dangqianbofangid);
                          soundId = dangqianbofangid;
                          bookId == dangqianbofangid;
                          fnBookExtraGoodssssss(bookId);
                          fnJianTingBookCollection(bookId);
                        }
                      } else {
                          api.addEventListener({
                              name: 'neizhiliebiaoPlaysss'
                          }, function(ret, err) {
                              listid = ret.value.playlistid;
                              playUrlis= ret.value.playUrli;
                              aa = ret.value.a;
                              bofangs = ret.value.bofang;
                              playType = ret.value.playType;
                              fnA(aa, bofangs, listid,playUrlis,playType);
                              fnAAaa(aa, bofangs, listid,playUrlis,playType);
                              bookId == aa;
                              fnBookExtraGoodssssss(bookId);
                              fnJianTingBookCollection(bookId);
                              return;
                          });
                          fnJinRuBofang();
                      }
                      var dialogBox = api.require('dialogBox');
                      dialogBox.close({
                          dialogName: 'alert'
                      });
                  } else if (ret.eventType == 'left') {
                      var stylelist = $api.byId('openplayer');
                      var html = '<img src="../image/play/ic_play_play.png" alt=""  id="player">';
                      $api.html(stylelist, html);
                      var dialogBox = api.require('dialogBox');
                      var stylelistkaishijishi = $api.byId('kaishijishi');
                      var htmlkaishijishi = '00:00';
                      $api.html(stylelistkaishijishi, htmlkaishijishi);
                      var stylelistzongshichang = $api.byId('zongshichang');
                      var htmlzongshichang = '00:00';
                      $api.html(stylelistzongshichang, htmlzongshichang);
                      var stylelistbookExtraGood = $api.byId('bookExtraGood');
                      var htmlbookExtraGood = '<img src="../image/KM_play_dianzan.png" alt="" class="collectmusicFxssss"><p>点赞</p>';
                      $api.html(stylelistbookExtraGood, htmlbookExtraGood);
                      var stylelistbookExtraCollectionHtml = $api.byId('bookExtraCollectionHtml');
                      var htmlbookExtraCollectionHtml = '<img src="../image/KM_play_collect.png" alt="" class="collectmusicssss" id="playCollect"  onclick="fnOpenPlayCollect(this)" data-click="0"><p>收藏</p>';
                      $api.html(stylelistbookExtraCollectionHtml, htmlbookExtraCollectionHtml);
                      var stylelistComments = $api.byId('comments');
                      var htmlComments = '0';
                      $api.html(stylelistComments, htmlComments);
                      api.closeWin();
                      dialogBox.close({
                          dialogName: 'alert'
                      });
                  }
              });
          }
      }
    }

    function fnFuCeng(){
      api.addEventListener({
          name: 'aaaaaaPlay'
      }, function(ret, err) {
          aaaaaa = ret.value.aaaaaa;
          if(aaaaaa == 2){

          }else if (aaaaaa == 1) {

          }
          return false;
      });
    }
    function fnJianTingGood(){
      api.addEventListener({
          name: 'neiJianTingGood'
      }, function(ret, err) {
          bookId = ret.value.bookId;
          soundId = ret.value.bookId;
          fnBookExtraGoodssssss(bookId);
          fnJianTingBookCollection(bookId);
          return false;
      });
    }
    function fnBoFangMoShiId(bofangMoShiId){
      bofangmoshi = bofangMoShiId;
      var stylelist = $api.byId('imagesImg');
      var html = '';
      if(bofangmoshi == 1){
        html = '<img src="../image/play/play_change1.png" alt="" id="img">';
      }else if(bofangmoshi == 2){
        html = '<img src="../image/play/play_change2.png" alt="" id="img">';
      }else if(bofangmoshi == 0){
        html = '<img src="../image/play/play_change0.png" alt="" id="img">';
      }else if(bofangmoshi == 'undefined'){
        html = '<img src="../image/play/play_change0.png" alt="" id="img">';
      }else{
        html = '<img src="../image/play/play_change0.png" alt="" id="img">';
      }
      $api.html(stylelist, html);
      fnOpenChangeImg(bofangmoshi);
    }
    //评论完成回调评论数；
    function fnJianTingPingLunShu(){
      api.addEventListener({
          name: 'gengXinSingle'
      }, function(ret, err) {
          fnJianTingBookCollection(bookId);
          return;
      });
    }
    //监听收藏，评论数；
    function fnJianTingBookCollection(bookId){

      if(bookId != 'undefined'){
        var ImgGif = $api.byId('ImgGif');
        var html = '<div class="loading"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></div>';
        $api.html(ImgGif, html);
        api.ajax({
            url: host + apiUri + '/sound/' + bookId,
            method: 'get',
            dataType: 'json',
            headers: {
                "source": api.systemType,
                "version": version,
                "session": token
            }
        }, function(ret, err) {
          if(ret){
          if (ret.status == 200) {
              var stylelistCollectionHtml = $api.byId('bookExtraCollectionHtml');
                if(ret.data.is_collection){
                  bookCollectionHtml = '<img src="../image/KM_play_collect_red.png" alt="" class="collectmusicssss" id="playCollect" onclick="fnOpenPlayCollect(this)" data-click="1"><p>收藏</p>';
                }else{
                  bookCollectionHtml = '<img src="../image/KM_play_collect.png" alt="" class="collectmusicssss" id="playCollect"  onclick="fnOpenPlayCollect(this)" data-click="0"><p>收藏</p>';
                }
              $api.html(stylelistCollectionHtml, bookCollectionHtml);
              if(ret.data.comment_total){
                  var html = ret.data.comment_total;
                  var stylelist = $api.byId('comments');
                  $api.html(stylelist, html);
              }else{
                var html = 0;
                var stylelist = $api.byId('comments');
                $api.html(stylelist, html);
              }
          } else {
              netMessage(ret);
          }
        }else{
          netWork(err);
        }
        });
      }

    }
    //1233

    var  bookGoodHtml;
    function fnBookExtraGoodssssss(bookIds){
      if(bookIds){
        var bookss = $api.getStorage('bookExtraGood'+bookIds);
      }else{
        var bookss = $api.getStorage('bookExtraGood'+bookId);
      }

      var bookg = 'inc';
      if(bookss){
        if(bookss != bookg){
          bookGoodHtml = '<img src="../image/KM_play_dianzan.png" alt="" class="collectmusicFxssss" id="playDz" onclick="fnOpenPlayDz(this)" data-click="0"><p>点赞</p>';
        }else{
          bookGoodHtml = '<img src="../image/KM_play_dianzan_red.png" alt="" class="collectmusicFxssss" id="playDz" onclick="fnOpenPlayDz(this)" data-click="1"><p>点赞</p>';
        }
      }else{
        bookGoodHtml = '<img src="../image/KM_play_dianzan.png" alt="" class="collectmusicFxssss"  id="playDz" onclick="fnOpenPlayDz(this)" data-click="0"><p>点赞</p>';
      }
      var stylelist = $api.byId('bookExtraGood');
      $api.html(stylelist, bookGoodHtml);
    }
    function fnDangQianbofangid(id,bofangs) {
        Dqbofangid = id;
        bofang = bofangs
    }

    function fnJinRuBofangs(ids,bofang,playType) {
      id =ids;
        var eHeader = $api.byId('header')
        api.parseTapmode();
        if(bofang == 3){
          var stylelist = $api.byId('openplayer');
          var html = '<img src="../image/play/ic_play_pause.png" alt="" onclick="fnOpenPlayer();" id="player">';
          $api.html(stylelist, html);
          if (id) {
            soundId = id;
              api.sendEvent({
                  name: 'netPlayingUrl',
                  extra: {
                      id: id
                  }
              });
              api.sendEvent({
                  name: 'neizhiliebiaoPlay',
                  extra: {
                      bofang: bofang,
                      a: id,
                      playType:playType
                  }
              });
          }
        }else{
          api.sendEvent({
              name: 'neizhiliebiaoPlay',
              extra: {
                  bofang: 2,
                  playType:playType
                  // a: id,
              }
          });
          var stylelist = $api.byId('openplayer');
          var html = '<img src="../image/play/ic_play_play.png" alt="" onclick="fnOpenPlayer();" id="player">';
          $api.html(stylelist, html);
        }
        fnInitSwiper();
        fnbofangshijian();
        fnJiBenXinXi();
        jindutiao();
        fnBookExtraGoodssssss();
    }

    function fnJinRuBofang(bofang) {
        var eHeader = $api.byId('header')
        if (bofang) {
            var bofang = bofang;
        } else {
            var bofang = api.pageParam.bofang;
        }
        playlistid = api.pageParam.playlistid;
        playUrli = api.pageParam.playUrli;
        playType = api.pageParam.playType;
        if(!playlistid){
          playlistid = api.pageParam.playid;
        }
        dqbfid = api.pageParam.a;
        id = api.pageParam.a;
        var is_play_all;
        if (!id){
          is_play_all = 1;
          // api.sendEvent({
          //     name: 'netPlayAotu',
          //     extra: {
          //         play: 0
          //     }
          // });
        }
        if(id == undefined){
          is_play_all = 1;
          // api.sendEvent({
          //     name: 'netPlayAotu',
          //     extra: {
          //         play: 0
          //     }
          // });
        }
        if (id) {
          soundId = id;
            api.sendEvent({
                name: 'netPlayUrl',
                extra: {
                    id: id
                }
            });
        }
        if (playlistid) {

          if(is_play_all){
            api.sendEvent({
                name: 'netPlayLieIdUrl',
                extra: {
                    playlistid: playlistid,
                    playUrli:playUrli,
                    is_play_all:is_play_all
                }
            });
          }else{
            api.sendEvent({
                name: 'netPlayLieIdUrl',
                extra: {
                    playlistid: playlistid,
                    playUrli:playUrli
                }
            });
          }

        }
        fnInitSwiper();
        api.parseTapmode();
        if (!bofang) {
            var stylelist = $api.byId('openplayer');
            var html = '';
            html += '<img src="../image/play/ic_play_pause.png" alt="" onclick="fnOpenPlayer();" id="player">';
            $api.html(stylelist, html);
            bofang = 3;
            api.sendEvent({
                name: 'neizhiliebiaoPlay',
                extra: {
                    bofang: bofang,
                    a: id,
                    playlistid: playlistid,
                    playUrli:playUrli,
                    playType:playType
                }
            });
            fnNetAudiosPlayByID(id);
        } else if (bofang == 2) {
            var stylelist = $api.byId('openplayer');
            var html = '';
            html += '<img src="../image/play/ic_play_play.png" alt="" onclick="fnOpenPlayer();" id="player">';
            $api.html(stylelist, html);
        } else if (bofang == 3) {
            var stylelist = $api.byId('openplayer');
            var html = '';
            html += '<img src="../image/play/ic_play_pause.png" alt="" onclick="fnOpenPlayer();" id="player">';
            $api.html(stylelist, html);
            api.sendEvent({
                name: 'neizhiliebiaoPlay',
                extra: {
                    bofang: bofang,
                    a: id,
                    playlistid: playlistid,
                    playUrli:playUrli,
                    playType:playType
                }
            });
            fnNetAudiosPlayByID(id);
        }
        fnbofangshijian();
        fnJiBenXinXi();
        jindutiao();
        if (dangqianbofangid) {
            dqbfid = dangqianbofangid;
        }
    }
    //内置列表页选择播放
    function fnA(a, bofangs, listid,playUrlis) {
        api.parseTapmode();
        aa = a;
        bofang = bofangs;
        playlistid = listid;
        playUrli = playUrlis;
        dqbfid = aa;
        id = aa;
        if (id) {
          soundId = id;
            api.sendEvent({
                name: 'netPlayUrl',
                extra: {
                    id: id
                }
            });
        }
        if (playlistid) {
            api.sendEvent({
                name: 'netPlayLieIdUrl',
                extra: {
                    playlistid: playlistid,
                    playUrli:playUrli
                }
            });
        }
        fnInitSwiper();
        if (!bofang) {
            var stylelist = $api.byId('openplayer');
            var html = '';
            html += '<img src="../image/play/ic_play_pause.png" alt="" onclick="fnOpenPlayer();" id="player">';
            $api.html(stylelist, html);
            bofang = 3;
            api.sendEvent({
                name: 'neizhiliebiaoPlay',
                extra: {
                    bofang: bofang,
                    a: id,
                    playlistid: playlistid,
                    playUrli:playUrli,
                    playType:playType
                }
            });
            fnNetAudiosPlayByID(id);
        } else if (bofang == 2) {
            var stylelist = $api.byId('openplayer');
            var html = '';
            html += '<img src="../image/play/ic_play_play.png" alt="" onclick="fnOpenPlayer();" id="player">';
            $api.html(stylelist, html);
        } else if (bofang == 3) {
            var stylelist = $api.byId('openplayer');
            var html = '';
            html += '<img src="../image/play/ic_play_pause.png" alt="" onclick="fnOpenPlayer();" id="player">';
            $api.html(stylelist, html);
            api.sendEvent({
                name: 'neizhiliebiaoPlay',
                extra: {
                    bofang: bofang,
                    a: id,
                    playlistid: playlistid,
                    playUrli:playUrli,
                    playType:playType
                }
            });
            fnNetAudiosPlayByID(id);
        }
        fnbofangshijian();
        fnJiBenXinXi();
        jindutiao();
        if (dangqianbofangid) {
            dqbfid = dangqianbofangid;
        }

    }

    function fnAAaa(aa, bofangs, listid,playUrlis,playTypes) {
        bofang = bofangs;
        playlistid = listid;
        playUrli = playUrlis;
        playType = playTypes
        dqbfid = aa;
        id = aa;
        soundId = aa;
    }
    //播放时间,总时长
    function fnbofangshijian() {
        api.addEventListener({
            name: 'bofangshijian'
        }, function(ret, err) {
            //播放时间
            if (ret.value.bofangshijian) {
                var stylelist = $api.byId('kaishijishi');
                var html = ret.value.bofangshijian;
                $api.html(stylelist, html);
            }else{
              var stylelist = $api.byId('kaishijishi');
              var html = '00:00';
              $api.html(stylelist, html);
            }
        });
        //总时长
        api.addEventListener({
            name: 'zongJinDusss'
        }, function(ret, err) {
            if (ret.value.html) {
              var ImgGif = $api.byId('ImgGif');
              var html = '';
              $api.html(ImgGif, html);
                var stylelist = $api.byId('zongshichang');
                var html = ret.value.html;
                $api.html(stylelist, html);
            }else{
              var stylelist = $api.byId('zongshichang');
              var html = '00:00';
              $api.html(stylelist, html);
            }
        });
    }
    function fnBoFangPlayType(){
      api.addEventListener({
          name: 'netBoFangPlayType'
      }, function(ret, err) {
          fnPlayType(ret.value.bofang,ret.value.playType);
      });
    }
    function fnPlayType(bofangs,playTypes){
      bofang = bofangs;
      playType =playTypes;
      if(bofang == 2){
        player.src = "../image/play/ic_play_play.png";
      }else if (bofang == 3) {
        player.src = "../image/play/ic_play_pause.png";
      }
    }
    //赋值歌词、总时长、标题
    function fnJiBenXinXi() {
        api.addEventListener({
            name: 'jibenxinxi'
        }, function(ret, err) {
            if (ret) {
                //赋值歌词
                if (ret.value.desc) {
                  if(ret.value.desc != "非文本内容"){
                    var str1 = JSON.stringify(ret.value.desc);
                    var str2 = str1.replace(/n/g, '<br>');
                    var str3 = str2.split('\\').join('');
                    var str4 = str3.split("\"").join('');
                    var stylelist = $api.byId('geci');
                    var html0 = str4;
                    $api.html(stylelist, html0);
                  }

                }
                //赋值标题
                if (ret.value.titlename) {
                    var stylelist = $api.byId('title');
                    var html2 = ret.value.titlename;
                    $api.html(stylelist, html2);
                    fnNamesss(ret.value.titlename);
                }
                if(ret.value.cover_big){
                  fnCover_big(ret.value.cover_big);
                }
            }
        });
    }
    var cover_big;
   function fnCover_big(cover_bigs){
     cover_big = cover_bigs;
   }
    function fnNamesss(titlenamesss){
          namesss = titlenamesss;
    }
    //播放、暂停
    function fnOpenPlayer() {
        var player = $api.byId('player');
        if (player.getAttribute("src", 2) == "../image/play/ic_play_play.png") {
            player.src = "../image/play/ic_play_pause.png";
            var bofang = 3;
            var a = api.pageParam.a;
            playlistid = api.pageParam.playlistid;
            playUrli = api.pageParam.playUrli;
            playType = api.pageParam.playType;
            if (!playlistid) {
                playlistid = api.pageParam.playid;
            }
            api.sendEvent({
                name: 'netPlay',
                extra: {
                    bofang: bofang,
                    a: a,
                    playlistid: playlistid,
                    playUrli:playUrli,
                    playType:playType
                }
            });
            api.sendEvent({
                name: 'neizhiliebiaoPlay',
                extra: {
                    bofang: bofang,
                    a: a,
                    playlistid: playlistid,
                    playUrli:playUrli,
                    playType:playType
                }
            });

        } else {
            player.src = "../image/play/ic_play_play.png";
            var netAudiopausess = 1;
            api.sendEvent({
                name: 'netAudiopauseSss',
                extra: {
                    netAudiopauses: netAudiopausess
                }
            });
            var bofang = 2;
            var a = api.pageParam.a;
            playlistid = api.pageParam.playlistid;
            playUrli = api.pageParam.playUrli;
            if (!playlistid) {
                playlistid = api.pageParam.playid;
            }
            api.sendEvent({
                name: 'neizhiliebiaoPlay',
                extra: {
                    bofang: bofang,
                    a: a,
                    playlistid: playlistid,
                    playUrli:playUrli,
                    playType:playType
                }
            });

        }
    }
    //进度条
    function jindutiao() {
        api.addEventListener({
            name: 'zongJinDu'
        }, function(ret, err) {
            if (ret) {
                var range = $api.byId('range');
                var lenth = ret.value.lenth;
                var cur = ret.value.cur;
                var a = cur / lenth;
                var ccc = JSON.stringify(cur/lenth  * 100);
                var sssss;
                if(!cur){
                  range.value = 0;
                  range.style.background = 'linear-gradient(to left, #89211b 100%, #f2f2f2 0,#f2f2f2  )';
                }else{
                  range.value = ccc;
                  sssss = 100 - range.value;

                  // if(ccc > 99){
                  //   range.value = 105;
                  //   sssss = 0;
                  // }
                  //不渐变
                  range.style.background = 'linear-gradient(to left, #89211b ' + sssss + '%, #f2f2f2 0,#f2f2f2  )';
                }

                // range.css( 'background', 'linear-gradient(to right, #059CFA, white ' + range.value + '%, white)' );
                // range.style.background = 'linear-gradient(to left, #89211b ' + sssss + '%, blue ' + range.value + '%,#789  )';
                fnZongJinDu(lenth);

            }
        });
    }

    function fnZongJinDu(lenth) {
        zongJindu = lenth;
    }
    //调整播放进度
    function adjust() {
        var range = $api.byId('range');
        var x = range.value / 100;
        var playTime = x * zongJindu;
        api.sendEvent({
            name: 'playTime',
            extra: {
                playTime: playTime
            }
        });
    }
    //上一曲
    function fnOpenPlayershangyi() {
        var player = $api.byId('player');
        player.src = "../image/play/ic_play_pause.png";
        var c = 1;
        api.sendEvent({
            name: 'GeDanshangyi',
            extra: {
                c: c
            }
        });
        fnOpenChangeImg();
    }
    //下一曲
    function fnOpenPlayerxiayi() {
        var c = 2;
        api.sendEvent({
            name: 'GeDanxiayi',
            extra: {
                c: c
            }
        });
        var player = $api.byId('player');
        player.src = "../image/play/ic_play_pause.png";
        fnOpenChangeImg();
    }
    //播放
    function fnNetAudiosPlayByID(id) {

        if (id) {
          uri = '/sound';
          var ImgGif = $api.byId('ImgGif');
          var html = '<div class="loading"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></div>';
          $api.html(ImgGif, html);
          api.ajax({
              url: host + apiUri + uri + '/' + id,
              method: 'get',
              dataType: 'json',
              timeout:10,
              headers: {
                  "source": api.systemType,
                  "version": version,
                  "session": token
              }
          }, function(ret, err) {

            if(ret){
            if (ret.status == 200) {
                netAudioss = ret;
                api.sendEvent({
                    name: 'netAudioplay',
                    extra: {
                        netAudios: netAudioss
                    }
                });
                var bofang = 3;
                var a = id;
                api.sendEvent({
                    name: 'neizhiliebiaoPlay',
                    extra: {
                        bofang: bofang,
                        a: a,
                        playlistid: playlistid,
                        playUrli:playUrli,
                        playType:playType
                    }
                });
                fnJiBenXinXi();
                fnbofangshijian();
                var title = ret.data.title;
                var author_name = ret.data.author_name;
            } else {
                netMessage(ret);
            }
          }else{
            netWork(err);
          }
          });

        } else {
            uri = '/sound';
            var ImgGif = $api.byId('ImgGif');
            var html = '<div class="loading"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></div>';
            $api.html(ImgGif, html);
            api.ajax({
                url: host + apiUri + uri + '/' + dqbfid,
                method: 'get',
                dataType: 'json',
                timeout:10,
                headers: {
                    "source": api.systemType,
                    "version": version,
                    "session": token
                }
            }, function(ret, err) {
              if(ret){
            if (ret.status == 200) {
              netAudioss = ret;
              api.sendEvent({
                  name: 'netAudioplay',
                  extra: {
                      netAudios: netAudioss
                  }
              });
              var bofang = 3;
              var a = api.pageParam.a;
              api.sendEvent({
                  name: 'neizhiliebiaoPlay',
                  extra: {
                      bofang: bofang,
                      a: a,
                      playlistid: playlistid,
                      playUrli:playUrli,
                      playType:playType
                  }
              });
              fnJiBenXinXi();
              fnbofangshijian();
              var title = ret.data.title;
              var author_name = ret.data.author_name;
            } else {
                netMessage(ret);
            }
          }else{
            netWork(err);
          }
          });

        }
    }

    // 轮播
    function fnInitSwiper() {
        var mySwiper = new Swiper('.swiper-container', {
            loop: false,
        });
    };
    // 切换单曲循环、顺序播放、随机播放
    function fnOpenChangeImg(bofangmoshi) {
        var image_urls = ["../image/play/play_change0.png", "../image/play/play_change1.png", "../image/play/play_change2.png"];
        // 初始化数组键值 (0 = 第一个图片)
        var idx = 0;
        if (!bofangmoshi) {
            bofangmoshi = 0;
            api.sendEvent({
                name: 'bofangmoshi',
                extra: {
                    bofangmoshi: bofangmoshi
                }
            });
            // 点击 id 为 img 的图片
            document.getElementById("img").onclick = function() {
                // idx + 1，如果为最后一张，还原回第一张
                idx = idx === image_urls.length - 1 ? 0 : idx + 1;
                // 设置 src
                this.src = image_urls[idx];
                if (idx == 1) {
                    bofangmoshi = 1;
                    api.sendEvent({
                        name: 'bofangmoshi',
                        extra: {
                            bofangmoshi: bofangmoshi
                        }
                    });
                } else if (idx == 2) {
                    bofangmoshi = 2;
                    api.sendEvent({
                        name: 'bofangmoshi',
                        extra: {
                            bofangmoshi: bofangmoshi
                        }
                    });
                } else if (idx == 0){
                    bofangmoshi = 0;
                    api.sendEvent({
                        name: 'bofangmoshi',
                        extra: {
                            bofangmoshi: bofangmoshi
                        }
                    });
                }else{
                  bofangmoshi = 0;
                  api.sendEvent({
                      name: 'bofangmoshi',
                      extra: {
                          bofangmoshi: bofangmoshi
                      }
                  });
                }
            };
        } else {
            // 点击 id 为 img 的图片
            document.getElementById("img").onclick = function() {
                // idx + 1，如果为最后一张，还原回第一张
                idx = idx === image_urls.length - 1 ? 0 : idx + 1;
                // 设置 src
                this.src = image_urls[idx];
                if (idx == 1) {
                    var bofangmoshi = 1;
                    api.sendEvent({
                        name: 'bofangmoshi',
                        extra: {
                            bofangmoshi: bofangmoshi
                        }
                    });
                } else if (idx == 2) {
                    var bofangmoshi = 2;
                    api.sendEvent({
                        name: 'bofangmoshi',
                        extra: {
                            bofangmoshi: bofangmoshi
                        }
                    });
                } else if (idx == 0){
                    bofangmoshi = 0;
                    api.sendEvent({
                        name: 'bofangmoshi',
                        extra: {
                            bofangmoshi: bofangmoshi
                        }
                    });
                }else {
                    var bofangmoshi = 0;
                    api.sendEvent({
                        name: 'bofangmoshi',
                        extra: {
                            bofangmoshi: bofangmoshi
                        }
                    });
                }
            };
            api.sendEvent({
                name: 'bofangmoshi',
                extra: {
                    bofangmoshi: bofangmoshi
                }
            });
        }




    }
    // 选择播放器
    function fnOpenChoicePlayer() {
        api.openWin({
            name: 'choicePlayer',
            url: './choice_player.html',
            pageParam: {
                ok: 'choice_player',
            }
        });
    };
    // 打开评论页面
    function fnOpenPlayDiscuss() {
      var uris = '/sound/comment/';
        api.openWin({
            name: 'discussNoticeDetail0',
            url: './discuss_notice_detail0.html',
            pageParam: {
                soundId: soundId,
                uris: uris,
                name: namesss,
                ok:'discuss_notice_detail0'
            }
        });
    }
    // 收藏
    function fnOpenPlayCollect(clicktoolitem) {
      var toolbarlist = document.getElementsByClassName('collectmusicssss')[0];
      var click = clicktoolitem.getAttribute("data-click");
      if (click == 0) {
          // 点开
          clicktoolitem.setAttribute("data-click", 1);
          toolbarlist.src = "../image/KM_play_collect_red.png";
          uri = '/extra/collection';
          api.ajax({
              url: host + apiUri + uri + '/' + bookId,
              method: 'post',
              dataType: 'json',
              timeout:10,
              headers: {
                  "source": api.systemType,
                  "version": version,
                  "session": token
              },
              data:{
                values:{
                  "model":'book',
                }
              }
          }, function(ret, err) {
            if(ret){
              if (ret.status == 200) {
                  if(ret.data == "inc"){
                    api.toast({              
                        msg:   '收藏成功',
                        duration:  2000,
                        location:   'middle'          
                    });
                  }
                  api.sendEvent({
                      name: 'collection',
                      extra: {
                          is_collection: 1,
                      }
                  });
              } else {
                netMessage(ret);
              }
            }else{
              netWork(err);
            }
          });
      } else {
          // 关闭
          clicktoolitem.setAttribute("data-click", 0);
          toolbarlist.src = "../image/KM_play_collect.png";
          uri = '/extra/collection';
          api.ajax({
              url: host + apiUri + uri + '/' + bookId,
              method: 'post',
              dataType: 'json',
              timeout:10,
              headers: {
                  "source": api.systemType,
                  "version": version,
                  "session": token
              },
              data:{
                values:{
                  "model":'book',
                }
              }
          }, function(ret, err) {
            if(ret){
              if (ret.status == 200) {
                  if(ret.data == "dec"){
                    api.toast({              
                        msg:   '已取消收藏',
                        duration:  2000,
                        location:   'middle'          
                    });
                  }
                  api.sendEvent({
                      name: 'collection',
                      extra: {
                          is_collection: 0,
                      }
                  });
              } else {
                netMessage(ret);
              }
            }else{
              netWork(err);
            }
          });
      }
    }
    // 点赞
    function fnOpenPlayDz(clicktoolitem) {
      var toolbarlist = document.getElementsByClassName('collectmusicFxssss')[0];
      var click = clicktoolitem.getAttribute("data-click");
      if (click == 0) {
        clicktoolitem.setAttribute("data-click", 1);
        toolbarlist.src = "../image/KM_play_dianzan_red.png";
        uri = '/extra/good';
        var url = host + apiUri + uri + '/' + bookId;
        api.ajax({
            url: host + apiUri + uri + '/' + bookId,
            method: 'post',
            dataType: 'json',
            timeout:10,
            headers: {
                "source": api.systemType,
                "version": version,
                "session": token
            },
            data:{
              values:{
                "type":'inc',
                "model":'book',
              },
            },
        }, function(ret, err) {
          if(ret){
            if (ret.status == 200) {
                api.toast({              
                    msg:   '已点赞',
                    duration:  2000,
                    location:   'middle'          
                });
                $api.setStorage('bookExtraGood'+bookId,'inc');
            } else {
              netMessage(ret);
            }
          }else{
            netWork(err);
          }
        });
      } else {
        // 关闭
        clicktoolitem.setAttribute("data-click", 0);
        toolbarlist.src = "../image/KM_play_dianzan.png";
        uri = '/extra/good';
        api.ajax({
            url: host + apiUri + uri + '/' + bookId,
            method: 'post',
            dataType: 'json',
            timeout:10,
            headers: {
                "source": api.systemType,
                "version": version,
                "session": token
            },
            data:{
              values:{
                "type":'dec',
                "model":'book',
              }
            }
        }, function(ret, err) {
          if(ret){
            if (ret.status == 200) {
                api.toast({              
                    msg:   '已取消点赞',
                    duration:  2000,
                    location:   'middle'          
                });
                $api.setStorage('bookExtraGood'+bookId,'dec');
            } else {
              netMessage(ret);
            }
          }else{
            netWork(err);
          }
        });
      }
    }
    //添加到听单
    function fnOpenAddListening() {
        api.openWin({
            name: 'addListening',
            url: './add_listening.html',
            pageParam: {
                songListID: soundId,
                ok:'add_listening'
            }
        });
    }

    //打开播放列表
    function openRadioList() {
        playlistid = api.pageParam.playlistid;
        playUrli = api.pageParam.playUrli;
        if (!playlistid) {
            playlistid = api.pageParam.playid;
        }
        var height = api.frameHeight;
        if (Dqbofangid) {
            api.openFrame({
                name: 'play_radiolist',
                url: './play_radiolist.html',
                bounces: false,
                bgColor: 'rgba(0,0,0,0.6)',
                rect: {
                    x: 0,
                    y: 0,
                    w: api.frameWidth,
                    h: height
                },
                pageParam: {
                    playlistid: playlistid,
                    Dqbofangid: Dqbofangid,
                    playUrli:playUrli
                }
            });
        } else {
            api.openFrame({
                name: 'play_radiolist',
                url: './play_radiolist.html',
                bounces: false,
                bgColor: 'rgba(0,0,0,0.6)',
                rect: {
                    x: 0,
                    y: 0,
                    w: api.frameWidth,
                    h: height
                },
                pageParam: {
                    playlistid: playlistid,
                    playUrli:playUrli
                }
            });
        }
    }
    // 分享
    function fnOpenPlayShare() {
      // console.log(id);

      var smas;
      if (cover_big == undefined ) {
        cover_big = '/logo_144x144.png'
        // fnOpenPlayShare(id, titleName,sma);
      }else {
        // fnOpenPlayShare(id, titleName,sma);
        smas = cover_big
      }
        // console.log(sma);
        var dialogBox = api.require('dialogBox');
        dialogBox.actionMenu({
            rect: {
                h: 150
            },
            texts: {
                cancel: '取消'
            },
            items: [{
                text: '微信',
                icon: 'widget://image/weixin.png'
            },  {
                text: '朋友圈',
                icon: 'widget://image/friends.png'
            }, {
                text: 'QQ',
                icon: 'widget://image/qq.png'
            },{
                text: 'QQ空间',
                icon: 'widget://image/QQkongjian.png'
            }],
            styles: {
                bg: '#FFF',
                column: 4,
                itemText: {
                    color: '#000',
                    size: 12,
                    marginT: 8
                },
                itemIcon: {
                    size: 30
                },
                cancel: {
                    bg: 'fs://icon.png',
                    color: '#000',
                    h: 44,
                    size: 14
                }
            },
            tapClose: true
        }, function(ret) {
            if (ret.eventType == 'cancel') {
                dialogBox.close({
                    dialogName: 'actionMenu'
                });
            }
            if (ret.index == "0") {
              var imgaesFx = host +'/'+ smas;
              // console.log(imgaesFx);
              api.download({
                  url: imgaesFx,
                  savePath: 'fs:savePath/'+ smas,
                  report: true,
                  cache: true,
                  allowResume: true
              }, function(ret, err) {
                // console.log(JSON.stringify(ret));
                  if (ret.state == 1) {
                      //下载成功
                      var savePath = ret.savePath;
                      // console.log(savePath);
                      var songListID = soundId;
                      var title = namesss;
                      shareMp3Single(songListID,title,savePath);
                      // var savePath = '';
                      // shareMp3Single(songListID,title,savePath);
                      // shareMp3Album(name,listening_description,l_id);
                  } else {
                    // console.log(JSON.stringify(err));
                  }
                });
                dialogBox.close({
                    dialogName: 'actionMenu'
                });
                // alert(1);
            } else if (ret.index == "1") {
              var imgaesFx = host +'/'+ smas;
              // console.log(imgaesFx);
              api.download({
                  url: imgaesFx,
                  savePath: 'fs:savePath/'+ smas,
                  report: true,
                  cache: true,
                  allowResume: true
              }, function(ret, err) {
                // console.log(JSON.stringify(ret));
                  if (ret.state == 1) {
                      //下载成功
                      var savePath = ret.savePath;
                      // console.log(savePath);
                      var songListID = soundId;
                      var title = namesss;
                      initTimelineSingle(songListID,title,savePath);
                      // var savePath = '';
                      // shareMp3Single(songListID,title,savePath);
                      // shareMp3Album(name,listening_description,l_id);
                  } else {
                    // console.log(JSON.stringify(err));
                  }
                });
                dialogBox.close({
                    dialogName: 'actionMenu'
                });
                // alert(3);
            } else if (ret.index == "2") {
              var imgaesFx = host +'/'+ smas;
              // console.log(imgaesFx);
              api.download({
                  url: imgaesFx,
                  savePath: 'fs:savePath/'+ smas,
                  report: true,
                  cache: true,
                  allowResume: true
              }, function(ret, err) {
                // console.log(JSON.stringify(ret));
                  if (ret.state == 1) {
                      //下载成功
                      var savePath = ret.savePath;
                      // console.log(savePath);
                      var songListID = soundId;
                      var title = namesss;
                      fnQQZoneSingle(songListID,title,savePath);
                      // var savePath = '';
                      // shareMp3Single(songListID,title,savePath);
                      // shareMp3Album(name,listening_description,l_id);
                  } else {
                    // console.log(JSON.stringify(err));
                  }
                });
                dialogBox.close({
                    dialogName: 'actionMenu'
                });
                // alert(2);

            }else if (ret.index == "3") {
              var imgaesFx = host +'/'+ smas;
              // console.log(imgaesFx);
              api.download({
                  url: imgaesFx,
                  savePath: 'fs:savePath/'+ smas,
                  report: true,
                  cache: true,
                  allowResume: true
              }, function(ret, err) {
                // console.log(JSON.stringify(ret));
                  if (ret.state == 1) {
                      //下载成功
                      var savePath = ret.savePath;
                      // console.log(savePath);
                      var songListID = soundId;
                      var title = namesss;

                      fnintnQQSingle(songListID,title,savePath);
                      // var savePath = '';
                      // shareMp3Single(songListID,title,savePath);
                      // shareMp3Album(name,listening_description,l_id);
                  } else {
                    // console.log(JSON.stringify(err));
                  }
                });
                dialogBox.close({
                    dialogName: 'actionMenu'
                });
                // alert(2);
            } else {
                dialogBox.close({
                    dialogName: 'actionMenu'
                });
            }
            // dialogBox.close({
            //     dialogName: 'alert'
            // })
            // alert(JSON.stringify(ret))

        });
                // alert(id);
    }

</script>
<script>
    var change = function($input) {
        /*内容可自行定义*/
        // console.log("123");
        adjust();
    }
    $('input').RangeSlider({

        callback: change
    });
</script>

</html>
