<!DOCTYPE html>
  <html>
  <head>
      <meta charset="utf-8">
      <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
      <title>孔孟之道--国友榜</title>
      <link rel="stylesheet" type="text/css" href="../css/api.css"/>
      <style>
        body,html{
          background-color: #f2f2f2;
        }

        .row {
            display: -webkit-box;
            display: -webkit-flex;
        }
        .col {
            -webkit-box-flex: 1;
            -webkit-flex: 1;
            flex: 1;
            margin: 0 5px;
            position: relative;
        }
        section{
          width:100%;
          text-align: center;
          margin: 0 auto;
          background-color: #f2f2f2;
        }
        .user-logo{
          height:120px;
    			background: #fff;
          margin:0 0 10px;
          padding-top: 10px;
    		}
    		.user-logo .user-img{
    			width: 80px;
          height: 80px;
          /*line-height: 80px;*/

          /*border: 5px solid #e5e5e5;*/
          margin: 0 auto;
    			/*background: url(../image/bangdan/default_head.png) no-repeat center center;
    			-webkit-background-size: contain;
    			background-size: contain;*/
    		}
        .user-logo .logo-img{
          height:80px;
          width:100%;
          text-align: center;
          margin:0 auto;
          overflow: hidden;
          border-radius: 40px;
        }
        .user-logo .logo-img img{
          width:80px;
          height:80px;
        }
        .user-logo .user-img>p{
          padding-top:10px;
          font-size: 14px;
          color:#000;
        }
        .bill-board-top{
          margin-bottom: 10px;
          background: #fff;
        }
        .bill-board-top>ul{
          padding:15px 0;
        }
        .bill-board-top>ul>li{
          border-right: 1px dashed #ccc;
        }
        .bill-board-top>ul>li:last-of-type{
          border-right: none;
        }
        .bill-board-top>ul>li>p{
          color:#666;
          font-size: 13px;
          line-height: 25px;
        }
        ul>li>p:last-of-type{
          color:#000000;
        }
        ul>li>p .num{
          color:#89211b;
        }
      </style>
  </head>
  <body>
    <section id="section">
      <!-- <div class="bill-board-top">
        <div class="user-logo" onclick="fnOpenmyPersonal();">
          <div class="user-img">
            <div class="logo-img"><img src="../image/bangdan/default_head.png" alt=""></div>
            <p>紫嫣 </p>
          </div>
        </div>
        <ul class="row">
          <li class="col">
            <p>学分</p>
            <p><span class="num">287</span>分</p>
          </li>
          <li class="col">
            <p>学时</p>
            <p><span class="num">1</span>小时<span class="num">30</span>分钟</p>
          </li>
          <li class="col">
            <p>作品</p>
            <p><span class="num">87</span>个</p>
          </li>
          <li class="col ">
            <p>被赞</p>
            <p><span class="num">999</span>次</p>
          </li>
        </ul>
      </div>
      <div class="bill-board-top">
        <div class="user-logo" onclick="fnOpenmyPersonal();">
          <div class="user-img">
            <div class="logo-img"><img src="../image/bangdan/default_head.png" alt=""></div>
            <p>紫嫣 </p>
          </div>
        </div>
        <ul class="row">
          <li class="col">
            <p>学分</p>
            <p><span class="num">287</span>分</p>
          </li>
          <li class="col">
            <p>学时</p>
            <p><span class="num">1</span>小时<span class="num">30</span>分钟</p>
          </li>
          <li class="col">
            <p>作品</p>
            <p><span class="num">87</span>个</p>
          </li>
          <li class="col ">
            <p>被赞</p>
            <p><span class="num">999</span>次</p>
          </li>
        </ul>
      </div> -->
    </section>
  </body>
  <script type="text/javascript" src="../script/api.js"></script>
  <script type="text/javascript" src="../script/common.js"></script>
  <script type="text/javascript" src="../script/message.js"></script>
  <script type="text/javascript">
  var token;
    apiready = function(){
      token = $api.getStorage('token');
      fnOpenFriend();
      api.setCustomRefreshHeaderInfo({
          bgColor: '#f0f0f0',
          image: {
              pull: [
                  'widget://image/Refresh/dropdown_anim_00.png',
                  'widget://image/Refresh/dropdown_anim_01.png',
                  'widget://image/Refresh/dropdown_anim_02.png',
                  'widget://image/Refresh/dropdown_anim_03.png',
                  'widget://image/Refresh/dropdown_anim_04.png',
                  'widget://image/Refresh/dropdown_anim_05.png',
                  'widget://image/Refresh/dropdown_anim_06.png',
                  'widget://image/Refresh/dropdown_anim_07.png',
                  'widget://image/Refresh/dropdown_anim_08.png',
                  'widget://image/Refresh/dropdown_anim_09.png',
                  'widget://image/Refresh/dropdown_anim_10.png',
              ],
              load: [
                  'widget://image/Refresh/dropdown_anim_00.png',
                  'widget://image/Refresh/dropdown_anim_01.png',
                  'widget://image/Refresh/dropdown_anim_02.png',
                  'widget://image/Refresh/dropdown_anim_03.png',
                  'widget://image/Refresh/dropdown_anim_04.png',
                  'widget://image/Refresh/dropdown_anim_05.png',
              ]
          }
      }, function() {
          //下拉刷新被触发，自动进入加载状态，使用 api.refreshHeaderLoadDone() 手动结束加载中状态
          //下拉刷新被触发，使用 api.refreshHeaderLoadDone() 结束加载中状态

          fnOpenFriend();

      });

    };
    //调接口
    function fnOpenFriend() {
      api.ajax({
          url: host + apiUri + '/index/billboard' + '?type=friend',
          method: 'get',
          dataType: 'json',
          timeout:10,
          headers: {
              "source": api.systemType,
              "version": version,
              "session": token
          }
      }, function(ret, err) {
          // console.log(JSON.stringify(ret));
          if(ret){
            if (ret.status == 200) {
                api.refreshHeaderLoadDone()
                var len= ret.data.length;
                var section = $api.byId('section');
                var htmls = '';
                for(var i = 0; i < len; i++){
                  var photo = ret.data[i].photo;
                  // console.log(photo);
                  if(ret.data[i].photo == null){
                    // html4 = '<img src="../image/bangdan/default_head.png" alt="">';
                    htmls += '<div class="bill-board-top">'+
                      '<div class="user-logo" onclick="fnOpenmyPersonal(\'' + ret.data[i].user_id + '\',\'' + ret.data[i].nick_name + '\');">'+
                        '<div class="user-img">'+
                          '<div class="logo-img"><img src="../image/bangdan/default_head.png" alt=""></div>'+
                          '<p >'+ret.data[i].nick_name+' </p>'+
                        '</div>'+
                      '</div>'+
                      '<ul class="row">'+
                        '<li class="col">'+
                          '<p>学分</p>'+
                          '<p><span class="num">'+ret.data[i].user_exp+'</span>分</p>'+
                        '</li>'+
                        '<li class="col">'+
                          '<p>学时</p>'+
                          '<p><span class="num">'+parseInt(ret.data[i].user_learn_time/60) +'</span>小时<span class="num">'+ret.data[i].user_learn_time%60+'</span>分钟</p>'+
                        '</li>'+
                        '<li class="col">'+
                          '<p>作品</p>'+
                          '<p><span class="num">'+ret.data[i].record_total+'</span>个</p>'+
                        '</li>'+
                        '<li class="col ">'+
                          '<p>被赞</p>'+
                          '<p><span class="num">'+ret.data[i].good_total+'</span>次</p>'+
                        '</li>'+
                      '</ul>'+
                    '</div>';
                    $api.html(section,htmls);
                  }else{
                    var photo = ret.data[i].photo.substring(0, 4);
                    if(photo == 'http' ){
                      // title = ret.data[i].photo;
                      // html4 = '<img src="' + ret.data[i].photo + '" alt="" />';
                      htmls += '<div class="bill-board-top">'+
                        '<div class="user-logo" onclick="fnOpenmyPersonal(\'' + ret.data[i].user_id + '\',\'' + ret.data[i].nick_name + '\');">'+
                          '<div class="user-img">'+
                            '<div class="logo-img"><img src="' + ret.data[i].photo + '" alt=""></div>'+
                            '<p >'+ret.data[i].nick_name+' </p>'+
                          '</div>'+
                        '</div>'+
                        '<ul class="row">'+
                          '<li class="col">'+
                            '<p>学分</p>'+
                            '<p><span class="num">'+ret.data[i].user_exp+'</span>分</p>'+
                          '</li>'+
                          '<li class="col">'+
                            '<p>学时</p>'+
                            '<p><span class="num">'+parseInt(ret.data[i].user_learn_time/60) +'</span>小时<span class="num">'+ret.data[i].user_learn_time%60+'</span>分钟</p>'+
                          '</li>'+
                          '<li class="col">'+
                            '<p>作品</p>'+
                            '<p><span class="num">'+ret.data[i].record_total+'</span>个</p>'+
                          '</li>'+
                          '<li class="col ">'+
                            '<p>被赞</p>'+
                            '<p><span class="num">'+ret.data[i].good_total+'</span>次</p>'+
                          '</li>'+
                        '</ul>'+
                      '</div>';
                      $api.html(section,htmls);
                    }
                    if(photo != 'http' ){
                      // html4 = '<img src="' + updatePhotoUrl + ret.data.photo + '" alt="" />';
                      htmls += '<div class="bill-board-top">'+
                        '<div class="user-logo" onclick="fnOpenmyPersonal(\'' + ret.data[i].user_id + '\',\'' + ret.data[i].nick_name + '\');">'+
                          '<div class="user-img">'+
                            '<div class="logo-img"><img src="' + updatePhotoUrl + ret.data[i].photo + '" alt=""></div>'+
                            '<p >'+ret.data[i].nick_name+' </p>'+
                          '</div>'+
                        '</div>'+
                        '<ul class="row">'+
                          '<li class="col">'+
                            '<p>学分</p>'+
                            '<p><span class="num">'+ret.data[i].user_exp+'</span>分</p>'+
                          '</li>'+
                          '<li class="col">'+
                            '<p>学时</p>'+
                            '<p><span class="num">'+parseInt(ret.data[i].user_learn_time/60) +'</span>小时<span class="num">'+ret.data[i].user_learn_time%60+'</span>分钟</p>'+
                          '</li>'+
                          '<li class="col">'+
                            '<p>作品</p>'+
                            '<p><span class="num">'+ret.data[i].record_total+'</span>个</p>'+
                          '</li>'+
                          '<li class="col ">'+
                            '<p>被赞</p>'+
                            '<p><span class="num">'+ret.data[i].good_total+'</span>次</p>'+
                          '</li>'+
                        '</ul>'+
                      '</div>';
                      $api.html(section,htmls);
                    }
                  }
                  $api.html(section,htmls);
                }
            } else {
                // console.log(JSON.stringify(err));
                netMessage(ret);
            }
          }else{
            netWork(err);
          }

      });
    }
    function fnOpenmyPersonal(id, nickname){
      api.openWin({
          name: 'myPersonal',
          url: './my_personal.html',
          pageParam: {
            userId: id,
            nickName: nickname,
            ok:'myPersonal1'
          }
      });
    }
  </script>
  </html>
