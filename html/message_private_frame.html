<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="copyright" content="www.apicloud.com" />
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <title>孔孟之道--私信</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css" />
    <style>
        html,
        body {
            min-height: 100%;
            background: #f2f2f2;
        }

        .fr {
            float: right;
        }

        .fl {
            float: left;
        }

        .mt5 {
            margin-top: 5px;
        }

        .mt10 {
            margin-top: 10px;
        }

        .mt15 {
            margin-top: 15px;
        }

        .mt20 {
            margin-top: 20px;
        }

        .ml5 {
            margin-left: 0.5em;
        }

        .mr5 {
            margin-right: 0.5em;
        }

        .hdivider {
            width: 100%;
            height: 1px;
            background-color: #f2f2f2;
        }

        .br {
            border-right: 1px solid #f2f2f2;
        }

        .bb {
            border-bottom: 1px solid #f2f2f2;
            height: 1px;
        }

        .toRight {
            right: 0;
        }

        .row {
            display: -webkit-box;
            display: -webkit-flex;
        }

        .col {
            -webkit-box-flex: 1;
            -webkit-flex: 1;
            flex: 1;
            margin: 0 5px;
            position: relative;
        }

        .swiper-container img {
            width: 100%;
        }
        /* 头部 */

        .nomessage {
            margin-top: 20px;
            font-size: 0.8em;
            text-align: center;
            color: #999;
        }

        section {
            border-top: 1px solid #ccc;
        }

        section>ul {
            margin: 0 10px;
        }

        section ul li {
            width: 100%;
            height: 50px;
            padding: 10px 0;
        }
        /*section ul li:nth-last-child(1){border-bottom: 1px solid #ccc;}*/
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        /*.user-img {
            width: 45px;
            height: 50px;
            line-height: 50px;
            display: inline-block;
        }

        .user-img>img {
            width: 45px;
        }

        .user-name {
            height: 50px;
            display: inline-block;
            vertical-align: top;
            position: relative;
            width: 85%;
            border-bottom: 1px solid #ccc;
        }

        .user-name p {
            font-size: 16px;
            color: #535354;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .user-name div .user_name_p2 {
            font-size: 12px;
            color: #999;
        }

        .user-name div .user_name_p1 {
            font-size: 14px;
            width: 100px;
            color: #999;
            word-break: keep-all;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .user-name div {
            width: 100%;
            height: 25px;
            line-height: 25px;
        }

        .user_name_span {
            position: relative;
        }

        .user_name_span1 {
            width: 90%;
            display: block;
            color: #999;
            font-size: 12px;
        }

        .user_name_span2 {
            display: block;
            width: 20px;
            height: 20px;
            position: absolute;
            top: 0px;
            right: 2.5px;
            background: red;
            border-radius: 10px;
            text-align: center;
            color: #fff;
            font-size: 10px;
            line-height: 20px;
        }*/
//////////////////////////////////
        .user-img{width:50px;height: 50px;line-height: 50px;display: inline-block;border-radius: 25px;overflow: hidden;}
        .user-img>img{width: 100%;}
        .user-name{height: 50px;display: inline-block;vertical-align: top;position: relative;width: 85%;
          border-bottom: 1px solid #ccc;}
        .user-name p{font-size: 16px;color: #535354;overflow: hidden;text-overflow: ellipsis;white-space:nowrap;}
        .user-name div .user_name_p2{font-size: 12px;color: #999;}
        .user-name div .user_name_p1{font-size: 14px;width:100px;color: #999; word-break: keep-all;white-space: nowrap; overflow: hidden;text-overflow: ellipsis;}
        .user-name div{width: 100%;height: 25px;line-height: 25px;}
        .user_name_span{position: relative;}
        .user_name_span1{width: 90%;display: block;color: #999;font-size: 12px;}
        .user_name_span2{display: block;position: absolute;top: 0px;right: 2.5px;border-radius: 10px;text-align: center;color: #fff;font-size: 10px;line-height: 20px;}
        .user_name_span2 div{background: red;width: 20px;height: 20px;position: absolute;top: 0px;right: 2.5px;border-radius: 10px;text-align: center;color: #fff;font-size: 10px;line-height: 20px;}

    </style>
</head>

<body>
<<<<<<< HEAD
    <section>
        <ul>
            <li onclick="fnOpenprivate()">
                <div class="user-img"><img src="../image/icon-person.png" alt=""></div>
                <div class="user-name">
                    <div>
                        <p class="fl user_name_p1">走不出胡同的猫</p>
                        <p class="fr user_name_p2">2017年12月30日</p>
                    </div>
                    <div class="user_name_span">
                        <span class="user_name_span1">金融工程</span>
                        <span class="user_name_span2" id="user_name_span2"></span>
                    </div>
                </div>
            </li>
    </section>
=======
<section>
  <ul id="section">

  </ul>
</section>
>>>>>>> 386f5a611de71a21ef982b7834b293070c462dbb
</body>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/common.js"></script>
<script type="text/javascript" src="../script/message.js"></script>;
<script type="text/javascript">
    var token;
<<<<<<< HEAD
    apiready = function() {
        token = $api.getStorage('token');
        // fnMessagePrivateFrame();
=======
    var p = 1;
    apiready = function (){
      token = $api.getStorage('token');
      fnMessagePrivateFrame();
      api.addEventListener({
          name: 'personalPrivateFrame'
      }, function(ret, err) {
          fnMessagePrivateFrame();
      });

>>>>>>> 386f5a611de71a21ef982b7834b293070c462dbb
    }

    function fnMessagePrivateFrame() {
<<<<<<< HEAD
        api.ajax({
            url: host + apiUri + '/message/lists',
            method: 'get',
            dataType: 'json',
            timeout:10,
            headers: {
                "source": api.systemType,
                "version": version,
                "session": token
            },
            data: {
                values: {
                    type: 3,
                    p: 1
                }
            }
        }, function(ret, err) {
            if (ret) {
                // console.log(JSON.stringify(ret));
            } else {
                // console.log(JSON.stringify(err));
            }
        });

    }
    //打开聊天页面
    function fnOpenprivate() {
        api.openWin({
            name: 'messagePrivateDetail',
            url: './message_private_detail.html',
            pageParam: {
                ok: 'message_private_detail'
            }
        });
    }
=======
      api.ajax({
        url: host + apiUri + '/message/lists',
        method: 'get',
        dataType: 'json',
        timeout:10,
        headers: {
            "source": api.systemType,
            "version": version,
            "session": token
        },
          data: {
              values: {
                  type: 3,
                  p:p
              }
          }
      },function(ret, err){
          if (ret) {
              // console.log(JSON.stringify(ret));
              if (ret.status == 200) {
                var html = '';
                var section = $api.byId('section');
                for (var i = 0; i < ret.data.list.length; i++) {
                    // console.log(1);
                    // console.log(ret.data.list[i].content);
                    var listening_cover = ret.data.list[i].friend_img;
                    var sandBox = listening_cover.substring(0, 4);
                    if (sandBox == 'http') {
                        images = ret.data.list[i].friend_img;
                    }else {
                      images = updatePhotoUrl + listening_cover;
                    }
                    function timestampToTime(timestamp) {
                        var date = new Date(timestamp * 1000);//时间戳为10位需*1000，时间戳为13位的话不需乘1000
                        Y = date.getFullYear() + '年';
                        M = (date.getMonth()+1 < 10 ? '0'+(date.getMonth()+1) : date.getMonth()+1) + '月';
                        D = date.getDate() + '日';
                        return Y+M+D;
                    }
                    var timestampToTimess =  timestampToTime(ret.data.list[i].modify_date);
                    var unread_nums;
                    // console.log(ret.data.list[i].unread_nums);
                    if (ret.data.list[i].unread_nums != 0) {
                        unread_nums = '<div>'+ret.data.list[i].unread_nums+'</div>'
                    }else {
                        unread_nums = ''
                    }
                    html += '<li onclick="fnOpenprivate('+ret.data.list[i].friend_id+',\''+ret.data.list[i].friend_name+'\')">'+
                          '<div class="user-img"><img src="'+images+'" alt=""></div>'+
                          '<div class="user-name">'+
                            '<div>'+
                              '<p class="fl user_name_p1">'+ret.data.list[i].friend_name+'</p>'+
                              '<p class="fr user_name_p2">'+timestampToTimess+'</p>'+
                            '</div>'+
                            '<div class="user_name_span">'+
                              '<span class="user_name_span1">'+ret.data.list[i].content+'</span>'+
                              '<span class="user_name_span2" id="user_name_span2">'+unread_nums+'</span>'+
                            '</div>'+
                          '</div>'+
                        '</li>'
                }
                $api.html(section, html);

              }
          } else {
              console.log(JSON.stringify(err));
          }
      });

    }
  //打开聊天页面
  function fnOpenprivate(userId,nickName){
    api.openWin({
      name: 'personalPrivate',
      url: './personal_private.html',
        pageParam: {
            userId: userId,
            nickName:nickName
        }
    });

  }
>>>>>>> 386f5a611de71a21ef982b7834b293070c462dbb
</script>

</html>
