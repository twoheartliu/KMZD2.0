<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="copyright" content="www.apicloud.com" />
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no" />
    <title>孔孟之道--首页推荐</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css" />
    <link rel="stylesheet" href="../css/swiper.min.css">
    <link rel="stylesheet" href="../css/iconfont/iconfont.css">
    <!-- <link rel="stylesheet" href="../css/iconfont.css"> -->
    <style>
        html,
        body {
            min-height: 100%;
            position: relative;
            margin-bottom: 30px;
        }

        .fr {
            float: right;
        }

        .fl {
            float: left;
        }

        .clear {
            clear: both;
        }

        .mt20 {
            margin-top: 20px;
        }

        .p20px {
            padding: 0 20px;
        }

        .row {
            display: -webkit-box;
            display: -webkit-flex;
        }

        .col {
            -webkit-box-flex: 1;
            -webkit-flex: 1;
            flex: 1;
            margin: 0 5px;
            position: relative;
        }

        .hdivider {
            width: 100%;
            height: 1px;
            background-color: #b2b2b2;
        }

        .hdivider:last-child {
            display: none;
        }
        /*轮播图 */
        /*img {*/
        /*display: block;*/
        /*}*/
        /*p {*/
        /*margin: 0;*/
        /*padding: 1rem 1rem;*/
        /*font-size: 1rem;*/
        /*line-height: 1.4;*/
        /*}*/

        .pagination {
            width: 100%;
            left: 0;
            bottom: 10px;
            position: absolute;
            text-align: center;
            -webkit-transition: 300ms;
            transition: 300ms;
            z-index: 10;
            -webkit-transform: translate3d(0, 0, 0);
            transform: translate3d(0, 0, 0);
        }

        .pagination span {
            width: 8px;
            height: 8px;
            display: inline-block;
            border-radius: 100%;
            background: #fff;
            opacity: .5;
            margin: 0 3px;
        }

        .pagination span.active {
            opacity: 1;
            background: #666;
        }

        .pic-panel {
            width: 100%;
            position: relative;
            overflow: hidden;
        }

        .pic-list {
            width: 100%;
            position: relative;
        }

        .pic-list li {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
        }

        .pic-list .re {
            position: relative;
            z-index: 2;
        }

        .pic-list li img {
            width: 100%;
        }

        .pic-list li a {
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
        }

        @media screen and (min-width: 600px) {
            .pic-box {
                position: relative;
                top: 0;
                left: 25%;
                width: 50%;
            }
            .pic-list li:nth-child(2) {
                left: 100%;
            }
            .pic-list li:last-child {
                left: -100%;
            }
            .pic-list li img {
                padding: 0 0.125rem;
                -webkit-box-sizing: border-box;
                box-sizing: border-box;
            }
        }
        /* 八大导航 */

        .nav {
            /*padding: 8px;*/
            margin-bottom: 20px;
            display: -webkit-box;
            display: -webkit-flex;
        }

        .navbar {
            -webkit-box-flex: 1;
            -webkit-flex: 1;
            flex: 1;
            position: relative;
            /*float: left; padding: 4px; box-sizing: border-box; background-clip: content-box;*/
            text-align: center;
            font-size: 14px;
            color: #1a1a1a;
        }

        .navbar img {
            width: 60px;
            height: 60px;
            display: block;
            text-align: center;
            margin: 0 auto;
            /*padding-top: 20px;*/
        }
        /*.navbar-item-hov { background-color: rgba(254, 242, 228, 0.7); }*/

        .navbar-item-active {
            color: #D43C33;
        }
        /* 听单推荐 */

        .hot {
            width: 100%;
            /* margin: 0 auto; */
            /*text-align: center;*/
            overflow: hidden;
        }

        .hotC {
            position: relative;
            float: left;
            /*border-radius: 5px;*/
            padding: 5px;
            box-sizing: border-box;
            background-clip: content-box;
            text-align: center;
            font-size: 20px;
            padding-top: 10px;
            padding-bottom: 10px;
            word-break: break-all;
        }

        .sectionTitle {
            margin-bottom: 10px;
            /*margin: 10px 0;*/
        }

        .sectionTitle .TD_div {
            font-size: 16px;
            color: #1a1a1a;
            padding-top: 2px;
            margin-top: 10px;
        }

        .sectionTitle .more {
            color: #666;
            font-size: 12px;
            margin-top: 10px;
        }

        .hotC img {
            /*border-radius: 10px;*/
            width: 100%;
        }

        .listtitle {
            font-size: 12px;
            color: #000;
            height: 24px;
            line-height: 12px;
            text-align: left;
        }

        .listtitle div {
            word-wrap: break-word;
        }
        /*个性化推荐 */

        .egret-flex-item {
            display: -webkit-box;
            -webkit-box-align: center;
            height: 100px;
        }

        .egret-flex-items {
            display: -webkit-box;
            -webkit-box-align: center;
            height: 100px;
            width: 80%;
        }

        .egret-flex-item-logo {
            max-width: 80px;
            min-width: 80px;
            /*margin-left: 0.5em; margin-right: 0.2em;*/
            -webkit-box-flex: 1;
            -webkit-box-align: center;
        }

        .egret-flex-item-logo img {
            height: 60px;
            width: 60px;
            /*border-radius: 5px;*/
            -webkit-box-align: center;
            vertical-align: top;
        }

        .egret-flex-item-shelf {
            overflow: hidden;
            -webkit-box-flex: 2;
            -webkit-box-align: center;
        }

        .egret-flex-item-shelf div {
            text-overflow: ellipsis;
            white-space: nowrap;
            overflow: hidden;
            /*margin-top: 5px;*/
            height: 22px;
            line-height: 22px;
        }

        .egret-flex-item-shelf .egret-flex-item-shelf01 .span1 {
            /*font-size: 13px;*/
            font-size: 15px;
            color: #000;
        }

        .egret-flex-item-shelf .egret-flex-item-shelf02 .span2 {
            font-size: 12px;
            color: #ff3db8;
            margin: 0 5px;
        }

        .egret-flex-item-shelf .egret-flex-item-shelf01 .span3 {
            font-size: 12px;
            color: #ccc;
        }

        .egret-flex-item-shelf04 {
            width: 18%;
            text-align: right;
            -webkit-box-flex: 1;
            -webkit-box-align: center;
            height: 65px;
        }

        .egret-flex-item-shelf04 img {
            width: 20px;
            height: 20px;
        }

        .egret-flex-item-shelf .egret-flex-item-shelf02 {
            font-size: 12px;
            color: #666;
        }

        .egret-flex-item-shelf .egret-flex-item-shelf02 span {
            font-size: 13px;
            color: #ccc;
        }

        .egret-flex-item-shelf03 {
            line-height: 20px;
        }

        .egret-flex-item-shelf03 div {
            float: left;
            /*line-height: 20px;
            margin: 5px 0px;*/
        }

        .egret-flex-item-shelf03 div img {
            width: 12px;
            height: 12px;
            line-height: 12px;
            margin: 0 2px;
        }

        .egret-flex-item-shelf03 div span {
            line-height: 22px;
            vertical-align: top;
            font-size: 11px;
            color: #b2b2b2;
        }

        .egret-flex-item-shelf .egret-flex-item-redclassify {
            color: #E03F40;
            border: 1px solid #E03F40;
            font-size: inherit;
            padding: 0 0.1em;
            /*border-radius: 1px;*/
            margin-right: 5px;
            box-sizing: border-box;
        }

        .w100 {
            width: 100%;
        }

        #floorId {
            width: 100%;
            margin: 0 auto;
        }
        /*.fmbtnhover { background: #D8D9DA; }*/
        /*加载loading的样式css 到结束*/

        #loadEffect {
            position: fixed;
            top: 33.33%;
            left: calc((50%) - 25px);
        }

        .loadEffect {
            width: 50px;
            height: 50px;
            position: absolute;
            margin: 0 auto;
            /*margin-top:100px;*/
            /*position: fixed;*/
        }

        .loadEffect span {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #ccc;
            position: absolute;
            -webkit-animation: load 1.04s ease infinite;
        }

        @-webkit-keyframes load {
            0% {
                opacity: 1;
            }
            100% {
                opacity: 0.2;
            }
        }

        .loadEffect span:nth-child(1) {
            left: 0;
            top: 50%;
            margin-top: -4px;
            -webkit-animation-delay: 0.13s;
        }

        .loadEffect span:nth-child(2) {
            left: 7px;
            top: 7px;
            -webkit-animation-delay: 0.26s;
        }

        .loadEffect span:nth-child(3) {
            left: 50%;
            top: 0;
            margin-left: -4px;
            -webkit-animation-delay: 0.39s;
        }

        .loadEffect span:nth-child(4) {
            top: 7px;
            right: 7px;
            -webkit-animation-delay: 0.52s;
        }

        .loadEffect span:nth-child(5) {
            right: 0;
            top: 50%;
            margin-top: -4px;
            -webkit-animation-delay: 0.65s;
        }

        .loadEffect span:nth-child(6) {
            right: 7px;
            bottom: 7px;
            -webkit-animation-delay: 0.78s;
        }

        .loadEffect span:nth-child(7) {
            bottom: 0;
            left: 50%;
            margin-left: -4px;
            -webkit-animation-delay: 0.91s;
        }

        .loadEffect span:nth-child(8) {
            bottom: 7px;
            left: 7px;
            -webkit-animation-delay: 1.04s;
        }
    </style>
</head>

<body>
    <!-- 轮播图 -->
    <div id="picPanel" class="pic-panel">
        <div id="picBox" class="pic-box">
            <ul id="picList" class="pic-list">
                <!-- <li class="re">
                					<a href="#">
                						<img src="img/1.jpg" />
                					</a>
                				</li> -->
            </ul>
        </div>
    </div>


    <!-- 八大导航 -->
    <div class="nav">
        <div class="navbar" tapmode="navbar-item-hov" onclick="fnGuoxueWin();"><img src="../image/index/KM_goxue.png" alt="">国学馆</div>
        <div class="navbar" tapmode="navbar-item-hov" onclick="fnListenWin();"><img src="../image/index/KM_listen.png" alt="">熏听</div>
        <div class="navbar" tapmode="navbar-item-hov" onclick="fnBillboard()"><img src="../image/index/KM_bangdan.png" alt="">榜单</div>
        <!-- <div class="navbar" tapmode="navbar-item-hov" onclick="fnReadWin();"><img src="../image/KM_langsong.png" alt="">国学机</div> -->
        <div class="navbar" tapmode="navbar-item-hov" onclick="fnReadWin();"><img src="../image/index/KM_guoxueji.png" alt="">国学机</div>
        <!-- <div class="clear"></div> -->
    </div>
    <!-- 2 热门推荐 -->
    <div class="w100">
        <div id="floorId">
            <!-- <div class="p20px">
              <div class="sectionTitle">
                  <span class="TD_div fl">专辑推荐</span>
                  <span class="fr more" onclick="fnRecommendWin();">更多</span>
                  <div class="clear"></div>
              </div>
              <div class="hot" id="hot">


              </div>
          </div>

          <div class="p20px">
              <div class="sectionTitle mt20" onclick="">
                  <span class="TD_div fl">优秀作品</span>
                  <span class="fr more" onclick="fnOpenExcellentWorks();">更多</span>
                  <div class="clear"></div>
              </div>
              <div class="egret-flex-item">
                  <div class="egret-flex-items" tapmode="fmbtnhover" onclick="fnOpenPlay()">
                      <div class="egret-flex-item-logo">
                          <img src="../image/KM_album.png" alt="" class="">
                      </div>
                      <div class="egret-flex-item-shelf">
                          <div class="egret-flex-item-shelf01">
                              <span class="span1 fl">作品：<span>《沁园春·雪》</span></span>
                          </div>
                          <div class="egret-flex-item-shelf02"><span>唐嫣</span>
                          </div>
                          <div class="egret-flex-item-shelf03">
                              <div><img src="../image/KM_play.png" alt=""><span>100</span></div>
                              <div><img src="../image/KM_zf.png" alt=""><span>100</span></div>
                              <div><img src="../image/KM_dz.png" alt=""><span>100</span></div>
                          </div>
                      </div>
                  </div>
                  <div class="egret-flex-item-shelf04" onclick="fnOpenPlayMore()">
                      <img src="../image/KM_list_more.png" alt="">
                  </div>
              </div>
              <div class="hdivider"></div>
          </div> -->
        </div>
    </div>
    <!-- 加载loading的dom -->
    <div id="loadEffect"></div>
    <!-- ~~~~ -->

</body>
<script type="text/javascript">
</script>


<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/common.js"></script>
<script type="text/javascript" src="../script/index.js"></script>
<script type="text/javascript" src="../script/message.js"></script>
<script type="text/javascript" src="../script/wxfx.js"></script>
<script type="text/javascript" src="../script/photoSlider-1.21.js"></script>


</html>
<script type="text/javascript">
    var token;
    var imgLot = true;
    apiready = function() {
        token = $api.getStorage('token');
        fnBanners();
        if (!token) {
            $api.rmStorage('token');
            api.openWin({
                name: 'login',
                url: '../login.html',
                pageParam: {
                    ok: 'login'
                }
            });
        } else {
            var qqziliao = api.pageParam.qqziliao;
            fnHomePageLayout();
            api.setCustomRefreshHeaderInfo({
                bgColor: '#f0f0f0',
                image: {
                    pull: [
                        'widget://image/Refresh/dropdown_anim_00.png',
                        'widget://image/Refresh/dropdown_anim_01.png',
                        'widget://image/Refresh/dropdown_anim_02.png',
                        'widget://image/Refresh/dropdown_anim_03.png',
                        'widget://image/Refresh/dropdown_anim_04.png',
                        'widget://image/Refresh/dropdown_anim_05.png',
                        'widget://image/Refresh/dropdown_anim_06.png',
                        'widget://image/Refresh/dropdown_anim_07.png',
                        'widget://image/Refresh/dropdown_anim_08.png',
                        'widget://image/Refresh/dropdown_anim_09.png',
                        'widget://image/Refresh/dropdown_anim_10.png',
                    ],
                    load: [
                        'widget://image/Refresh/dropdown_anim_00.png',
                        'widget://image/Refresh/dropdown_anim_01.png',
                        'widget://image/Refresh/dropdown_anim_02.png',
                        'widget://image/Refresh/dropdown_anim_03.png',
                        'widget://image/Refresh/dropdown_anim_04.png',
                        'widget://image/Refresh/dropdown_anim_05.png',

                    ]
                }
            }, function() {
                //下拉刷新被触发，自动进入加载状态，使用 api.refreshHeaderLoadDone() 手动结束加载中状态
                //下拉刷新被触发，使用 api.refreshHeaderLoadDone() 结束加载中状态
                // fnBanners();
                fnHomePageLayout();
            });
            api.addEventListener({
                name: 'neiJianTingBFms'
            }, function(ret, err) {
                bofangmoshi = ret.value.bofangmoshiid;

                fnBoFangMoShiId(bofangmoshi);
                return;
            });
        }
        // fnInitSwiper();

    }
    var bofangmoshi;

    function fnBoFangMoShiId(bofangmoshiss) {
        bofangmoshi = bofangmoshiss;
    }
    //  banner 接口
    function fnBanners() {
        var uri = '/extra/banner';
        // var position = 'index'
        api.ajax({
            url: host + apiUri + uri,
            method: 'get',
            dataType: 'json',
            timeout: 10,
            headers: {
                "source": api.systemType,
                "version": version,
                "session": token,
            },
            data: {
                values: {
                    position: 'index',
                },

            }
        }, function(ret, err) {
            if (ret) {
                if (ret.status == 200) {
                    var data = ret.data;
                    var len = ret.data.length;
                    var banners = '';
                    for (var i = 0; i < len; i++) {
                        var banner_id = ret.data[i].banner_id;
                        var title = ret.data[i].title;
                        var img = ret.data[i].img;
                        var description = ret.data[i].description;
                        var banner_types = ret.data[i].type;
                        var content = ret.data[i].content;
                        // swiper-wrapper
                        if (img == null) {
                            imgs = "../image/index/KM_swiper1.jpg";
                        } else {
                            imgs = uploadsBanner + img
                        }
                        var stylelist = $api.byId('picList');
                        // <div class="swiper-wrapper"></div>
                        if (len == 1) {
                          imgLot = false;
                          banners += '<li onclick="fnOpenBanners(\'' + banner_id + '\',\'' + title + '\',\'' + description + '\',\'' + banner_types + '\',\'' + content + '\')"><img src="' + imgs + '" alt=""></li>'
                        }else {
                          imgLot = true;
                        }
                        if (i == 0) {
                            banners += '<li class="re" onclick="fnOpenBanners(\'' + banner_id + '\',\'' + title + '\',\'' + description + '\',\'' + banner_types + '\',\'' + content + '\')"><img src="' + imgs + '" alt=""></li>'
                        } else {
                            banners += '<li onclick="fnOpenBanners(\'' + banner_id + '\',\'' + title + '\',\'' + description + '\',\'' + banner_types + '\',\'' + content + '\')"><img src="' + imgs + '" alt=""></li>'
                        }
                        // <div class="swiper-slide" onclick=""><img src="../image/index/KM_swiper1.jpg" alt=""></div>
                        // \'' + banner_id + '\',\''+ title +'\',\''+ description +'\',\''+ banner_types +'\',\''+ content +'\'
                        // <img src="http://47.100.11.38/kmzd/public/uploads/banner/banner_2.jpg" alt="">
                    }
                    $api.html(stylelist, banners);
                    // console.log(JSON.stringify( ret ));
                    // alert( JSON.stringify( ret ) );
                    fnInitSwiper();
                } else {
                    netMessage(ret);
                }
            } else {
                netWork(err);
            }
        });

    }



    // 打开浏览器
    function openBrowser(s) {
        api.openApp({
            androidPkg: 'android.intent.action.VIEW',
            mimeType: 'text/html',
            uri: s,
            iosUrl: s,
        }, function(ret, err) {
            if (ret) {
                // alert(JSON.stringify(ret));
            } else {
                // alert(JSON.stringify(err));
            }
        });

    }

    function fnOpenBanners(banner_id, title, description, banner_types, content) {
        var lujing;
        var song_id;
        var titles;
        var frames;
        if (!content) {
            return false;
        }
        if (banner_types == 1) {
            lujing = openBrowser(content);
            // console.log(lujing);
        } else if (banner_types == 2) {
            lujing = './playDanQu.html';
            song_id = content;
        } else if (banner_types == 3) {
            // 专辑
            lujing = './single.html';
            song_id = content;
            titles = '专辑';
        } else if (banner_types == 4) {
            //听单
            lujing = './ListingsList.html';
            song_id = content;
            titles = '听单';
        } else if (banner_types == 5) {
            lujing = '../res/to_user.html';
            frames = content;
            titles = title;
        } else if (banner_types == 6) {
            lujing = content;
        } else if (banner_types == 7) {
            lujing = content;
            // console.log(content);
        } else {
            return
        }
        api.openWin({
            name: lujing,
            url: lujing,
            // console.log('lujing');
            pageParam: {
                title: title,
                description: description,
                type: banner_types,
                content: content,
                song_id: song_id,
                albumId: song_id,
                floor_name: titles,
                a: song_id,
                ok: lujing,
                bofangmoshi: bofangmoshi,
                frameUrl: frames,
                titles: titles,
            }
        });

    }


    // console.log(token);
    function fnHomePageLayout() {
        uri = '/index/floor';
        api.ajax({
            url: host + apiUri + uri,
            // url:'https://api.kmzhidao.com/kmzd/2.0/index/floor',
            method: 'get',
            dataType: 'json',
            timeout: 10,
            headers: {
                "source": api.systemType,
                "version": version,
                "session": token
            },
        }, function(ret, err) {
            // console.log(JSON.stringify(err));
            if (ret) {
                if (ret.status == 200) {

                    // fnRecommendedDirectory(ret);
                    api.refreshHeaderLoadDone()
                    fnPageLayoutAssignment(ret);
                } else {
                    api.refreshHeaderLoadDone();
                    netMessage(ret);
                }
            } else {
                api.refreshHeaderLoadDone();
                netWork(err);
            }

        });
    }

    function fnPageLayoutAssignment(data_) {
        var stylelist = $api.byId('floorId');
        var frameWidth = api.frameWidth;
        var html = '';
        var s_length = '';
        // console.log(JSON.stringify(data_));
        for (var i = 0; i < data_.data.length; i++) {
            if (data_.data[i].floor_id) {
                html += '<div class="p20px"  id="ret.data[i].floor_id"><div class="sectionTitle mt20"><span class="TD_div fl">' + data_.data[i].floor_name + '</span><span class="fr more" onclick="fnRecommendWin(' + data_.data[i].floor_id +
                    ',\'' + data_.data[i].floor_name + '\');">更多</span><div class="clear"></div><div class="clear"></div></div><div class="hot" id="hot">';
                var column = data_.data[i].floor_column;
                var row = data_.data[i].floor_row;
                var urlName = data_.data[i].content_type;
                if (column == 0) {
                    column = 1;
                }
                s_length = (data_.data[i].content.length < column * row) ? data_.data[i].content.length : column * row;
                for (var s = 0; s < s_length; s++) {

                    if (data_.data[i].floor_type == "block") {
                        if (data_.data[i].content_type == "album") {
                            var cccc = column;
                            var ssss = frameWidth - 50;
                            var xxxx = ssss / cccc;
                            // style="width:' + xxxx + 'px;"
                            html += '<div class="hotC" style="width:' + xxxx + 'px;" onclick="fnSingLeWin(' + data_.data[i].content[s].id + ',\'' + data_.data[i].floor_name + '\',\'' + data_.data[i].content_type + '\');"><img src=" ' + host + '/' +
                                data_.data[i].content[s].big + '" alt=""><div class="listtitle" style=""> ' + data_.data[
                                    i].content[s].title + '</div></div>';
                        } else if (data_.data[i].content_type == "listening") {
                            var cccc = column;
                            var ssss = frameWidth - 50;
                            var xxxx = ssss / cccc;
                            // style = "width:' + xxxx + 'px;"
                            html += '<div class="hotC" style="width:' + xxxx + 'px;" onclick="fnSingLeWin(' + data_.data[i].content[s].id + ',\'' + data_.data[i].floor_name + '\',\'' + data_.data[i].content_type + '\');"><img src=" ' + listeningImg +
                                data_.data[i].content[s].sma + '" alt=""><div class="listtitle" style="">' + data_.data[
                                    i].content[s].title + '</div></div>';
                        }

                        // var cccc = column;
                        // var ssss = frameWidth - 50;
                        // var xxxx = ssss / cccc;
                        //
                        // // style="width:' + xxxx + 'px;"
                        // html += '<div class="hotC" style="width:' + xxxx + 'px;" onclick="fnSingLeWin(' + data_.data[i].content[s].id + ',\'' + data_.data[i].floor_name + '\',\'' + data_.data[i].content_type + '\');"><img src=" ' + host + '/' + data_.data[i].content[s].sma + '" alt=""><div class="listtitle" style="width:' + xxxx + 'px;"> ' + data_.data[
                        //     i].content[s].title + '</div></div>';

                    } else if (data_.data[i].floor_type == "list") {
                        // console.log(data_.data[i].content[s].mid);
                        Covers = host + '/' + data_.data[i].content[s].mid
                        // console.log(Covers);
                        if (data_.data[i].content[s].author_name) {
                            html += '<div class="egret-flex-item"><div class="egret-flex-items" tapmode="fmbtnhover" onclick="fnOpenPlay(' + data_.data[i].content[s].id + ',\'' + data_.data[i].content[s].mid + '\')"><div class="egret-flex-item-logo"><img src="' + host + '/' + data_.data[i]
                                .content[s].mid + '" alt="" class=""></div><div class="egret-flex-item-shelf"><div class="egret-flex-item-shelf01"><span class="span1 fl"><span>' + data_.data[i].content[s].title +
                                '</span></span></div><div class="egret-flex-item-shelf02"><span>作者：' +
                                data_.data[i].content[s].author_name + '</span></div><div class="egret-flex-item-shelf03"><div><img src="../image/KM_play.png" alt=""><span>' + data_.data[
                                    i].content[s].play_total + '</span></div><div><img src="../image/KM_zf.png" alt=""><span>' + data_.data[i].content[s].share_total +
                                '</span></div><div><img src="../image/KM_dz.png" alt=""><span>' + data_.data[i].content[s].good_total +
                                '</span></div></div></div>  </div><div class="egret-flex-item-shelf04" onclick="fnOpenPlayMore(' + data_.data[i].content[s].id + ',\'' + data_.data[i].content[s].mid + '\',\'' + data_.data[i].content[s].title +
                                '\')"><img src="../image/KM_list_more.png" alt=""></div></div><div class="hdivider"></div>';

                        } else {
                            html += '<div class="egret-flex-item"><div class="egret-flex-items" tapmode="fmbtnhover" onclick="fnOpenPlay(' + data_.data[i].content[s].id + ',\'' + data_.data[i].content[s].mid + '\')"><div class="egret-flex-item-logo"><img src="' + host + '/' + data_.data[i]
                                .content[s].mid + '" alt="" class=""></div><div class="egret-flex-item-shelf"><div class="egret-flex-item-shelf01"><span class="span1 fl"><span>' + data_.data[i].content[s].title +
                                '</span></span></div><div class="egret-flex-item-shelf02"><span>作者：</span></div><div class="egret-flex-item-shelf03"><div><img src="../image/KM_play.png" alt=""><span>' + data_.data[
                                    i].content[s].play_total + '</span></div><div><img src="../image/KM_zf.png" alt=""><span>' + data_.data[i].content[s].share_total +
                                '</span></div><div><img src="../image/KM_dz.png" alt=""><span>' + data_.data[i].content[s].good_total +
                                '</span></div></div></div>  </div><div class="egret-flex-item-shelf04" onclick="fnOpenPlayMore(' + data_.data[i].content[s].id + ',\'' + data_.data[i].content[s].mid + '\',\'' + data_.data[i].content[s].title +
                                '\')"><img src="../image/KM_list_more.png" alt=""></div></div><div class="hdivider"></div>';
                        }
                    }
                }
                html += '</div></div>';
            }
        }
        $api.html(stylelist, html);
    }
    // //接口  推荐听单
    // function fnXiMaLaYaTingDan() {
    //     var ximalaya = null;
    //     var ximalaya = api.require('ximalaya');
    //     var param = {
    //         appkey: "85fa4ef92fb9ab9ee237146d59b44530",
    //         appsecret: "a537faf18f2ba543fbabe3dad47b3511"
    //     };
    //     ximalaya.initXmly(param, function(ret, err) {
    //         // alert(JSON.stringify(ret));
    //         if (ret) {
    //             alert(JSON.stringify(ret.message));
    //         } else {
    //             //console.log(JSON.stringify(err));
    //             alert(JSON.stringify(err));
    //         }
    //     });
    //
    //     function getSearchedTracks() {
    //         var param = {
    //             keyword: "爱情",
    //             categoryid: 1,
    //             page: 1,
    //             pagesize: 3
    //         };
    //         ximalaya.getSearchedTracks(param, function(ret, err) {
    //             if (ret)
    //                 alert(JSON.stringify(ret.total_count));
    //             else
    //                 alert(JSON.stringify(err));
    //         });
    //     }
    //     // var param = {
    //     //     //appkey: "a2bef6e953c529b6ac0b656a32079ecf",
    //     //     appsecret: "e1f6e1927fdab1ef1a8de1997557b6db"
    //     // };
    //     // ximalaya.initXmly(param, function(ret, err) {
    //     //     if (ret)
    //     //         alert(JSON.stringify(ret));
    //     //     else
    //     //         alert(JSON.stringify(err));
    //     // });
    //
    // }

    function fnSingLeWin(id, name, urlNames) {

        if (urlNames == 'listening') {
            urlName = 'ListingsList';
            var ListingsListIndex0 = 'ListingsListIndex0'
        } else if (urlNames == 'album') {
            urlName = 'single';
        }
        api.openWin({
            name: urlName,
            url: './' + urlName + '.html',
            pageParam: {
                albumId: id,
                ok: urlName,
                floor_name: name,
                pk: 'urlName',
                bofangmoshi: bofangmoshi,
                ListingsListIndex0: ListingsListIndex0
            }
        });

    }

    function fnRecommendWin(id, name) {
        api.openWin({
            name: 'recommend',
            url: './recommend.html',
            pageParam: {
                id: id,
                name: name,
                ok: 'recommend',
                bofangmoshi: bofangmoshi
            }
        });

    }

    function fnInitSwiper() {
        // document.addEventListener('DOMContentLoaded',function(){
        photoSlide({
            wrap: document.getElementById('picBox'),
            loop: true,
            autoPlay: imgLot,
            autoTime: 4000,
            pagination: imgLot
        });
        // }, false);
        //     var mySwiper = new Swiper('.swiper-container', {
        //         autoplay: true, //可选选项，自动滑动
        //         loop: true
        //     });
    };

    function fnGuoxueWin() {
        api.openWin({
            name: 'guoxue',
            url: './guoxue.html',
            pageParam: {
                ok: 'guoxueok',

            }
        });

    }

    var Dqbofangid;
    var bofang;

    function fnDangQianbofangid(id, bofangs) {
        Dqbofangid = id;
        bofang = bofangs;
    }

    //打开熏听页面
    function fnListenWin() {
        api.addEventListener({
            name: 'netbofangsssssss'
        }, function(ret, err) {
            fnDangQianbofangid(ret.value.a, ret.value.bofang);
        });
        if (Dqbofangid == 100000000000000000000) {
            api.openWin({
                name: 'listenTo',
                url: './listen_to.html',
                pageParam: {
                    DangQianbofangid: Dqbofangid,
                    ok: 'listen_to',
                    bofang: bofang,
                    playType: 'listen_to'
                }
            });
        } else {
            api.openWin({
                name: 'listenTo',
                url: './listen_to.html',
                pageParam: {
                    ok: 'listen_to',
                    playType: 'listen_to'

                }
            });
        }
    }
    // 打开优秀作品更多页面
    // function fnOpenExcellentWorks() {
    //     api.openWin({
    //         name: 'excellentWorks',
    //         url: './excellent_works.html',
    //         pageParam:{
    //             ok: 'excellent_works'
    //         }
    //     });
    // }
    // 打开榜单页面
    function fnBillboard() {
        api.openWin({
            name: 'billBoard',
            url: './bill_board.html',
        });
        pageParam: {
            ok: 'bill_board'
        }
    }
    // 打开国学机页面
    function fnReadWin() {
        api.openWin({
            name: 'machine',
            url: './machine.html',
            pageParam: {
                name: 'machine'
            }
        });

    }

    //作品列表进入播放页面
    function fnOpenPlay(a, Covers) {
        api.addEventListener({
            name: 'netbofangsssssss'
        }, function(ret, err) {
            if (a == ret.value.a) {
                fnDangQianbofangid(ret.value.a, ret.value.bofang);
            }
        });
        var playlistid = api.pageParam.albumId;

        if (Dqbofangid == a) {
            api.openWin({
                name: 'playDanQu',
                url: './playDanQu.html',
                pageParam: {
                    a: a,
                    // danQu:'danQu',
                    dangqianbofangid: Dqbofangid,
                    ok: 'playDanQu',
                    bofangmoshi: bofangmoshi,
                    bofang: bofang,
                    playType: 'playDanQu',
                }
            });
        } else {
            api.openWin({
                name: 'playDanQu',
                url: './playDanQu.html',
                pageParam: {
                    a: a,
                    // danQu:'danQu',
                    ok: 'playDanQu',
                    bofangmoshi: bofangmoshi,
                    playType: 'playDanQu',
                }
            });

        }
    }
    //打开更多页面
    function fnOpenPlayMore(id, sma, titleName) {
        var dialogBox = api.require('dialogBox');
        dialogBox.actionMenu({
            rect: {
                h: 150
            },
            texts: {
                cancel: '取消'
            },
            items: [{
                text: '收藏',
                icon: 'widget://image/KM_hxs.png'
            }, {
                text: '添加到听单',
                icon: 'widget://image/KM_play_add_gray.png'
            }, {
                text: '分享',
                icon: 'widget://image/KM_ListingsListGd.png'
            }],
            styles: {
                bg: '#FFF',
                column: 3,
                itemText: {
                    color: '#000',
                    size: 12,
                    marginT: 8
                },
                itemIcon: {
                    size: 30
                },
                cancel: {
                    bg: 'fs://icon.png',
                    color: '#000',
                    h: 44,
                    size: 14
                }
            },
            tapClose: true
        }, function(ret) {
            if (ret.eventType == 'cancel') {
                dialogBox.close({
                    dialogName: 'actionMenu'
                });
            }
            if (ret.index == "0") {
                // 刚开始的时候加载loading
                var loadEffect = $api.byId('loadEffect');
                htmlloadEffect = '<div class="loadEffect"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></div>'
                $api.html(loadEffect, htmlloadEffect);

                uri = '/extra/list_collection/';
                api.ajax({
                    url: host + apiUri + uri + id,
                    method: 'post',
                    dataType: 'json',
                    timeout: 10,
                    headers: {
                        "source": api.systemType,
                        "version": version,
                        "session": token
                    },
                    data: {
                        values: {
                            "model": 'book',
                        }
                    }
                }, function(ret, err) {
                    // 这个是关闭loading再掉通第一个接口的地方加
                    var loadEffect = $api.byId('loadEffect');
                    htmlloadEffect = '';
                    $api.html(loadEffect, htmlloadEffect);
                    // ~~~~~~~~~~~~~~
                    if (ret) {

                        if (ret.status == 200) {


                            api.toast({              
                                msg:   '收藏成功',
                                duration:  2000,
                                location:   'middle'          
                            });


                        } else {
                            netMessage(ret);
                        }
                    } else {
                        netWork(err);
                    }

                });
                dialogBox.close({
                    dialogName: 'actionMenu'
                });
            } else if (ret.index == "1") {
                fnOpenAddListening(id);

                dialogBox.close({
                    dialogName: 'actionMenu'
                });
                // alert(2);
            } else if (ret.index == "2") {
                dialogBox.close({
                    dialogName: 'actionMenu'
                });
                // if (sma == undefined ) {
                //   var sma = '/logo_144x144.png'
                //   fnOpenPlayShare(id, titleName,sma);
                // }else {
                //   fnOpenPlayShare(id, titleName,sma);
                // }

                fnOpenPlayShare(id, sma, titleName);

                // alert(3);
            } else {
                dialogBox.close({
                    dialogName: 'actionMenu'
                });
            }
            // dialogBox.close({
            //     dialogName: 'alert'
            // })
            // alert(JSON.stringify(ret))

        });
    }
    //打开分享
    function fnOpenPlayShare(id, sma, titleName) {
        var smas;

        if (sma == undefined) {
            smas = '/logo_144x144.png'
                // fnOpenPlayShare(id, titleName,sma);
        } else {
            // fnOpenPlayShare(id, titleName,sma);
            smas = sma
        }

        var dialogBox = api.require('dialogBox');
        dialogBox.actionMenu({
            rect: {
                h: 150
            },
            texts: {
                cancel: '取消'
            },
            items: [{
                text: '微信',
                icon: 'widget://image/weixin.png'
            }, {
                text: '朋友圈',
                icon: 'widget://image/friends.png'
            }, {
                text: 'QQ',
                icon: 'widget://image/qq.png'
            }, {
                text: 'QQ空间',
                icon: 'widget://image/QQkongjian.png'
            }],
            styles: {
                bg: '#FFF',
                column: 4,
                itemText: {
                    color: '#000',
                    size: 12,
                    marginT: 8
                },
                itemIcon: {
                    size: 30
                },
                cancel: {
                    bg: 'fs://icon.png',
                    color: '#000',
                    h: 44,
                    size: 14
                }
            },
            tapClose: true
        }, function(ret) {
            if (ret.eventType == 'cancel') {
                dialogBox.close({
                    dialogName: 'actionMenu'
                });
            }
            if (ret.index == "0") {
                var imgaesFx = host + '/' + smas;
                api.download({
                    url: imgaesFx,
                    savePath: 'fs://savePath/' + smas,
                    report: true,
                    cache: true,
                    allowResume: true
                }, function(ret, err) {
                    if (ret.state == 1) {
                        //下载成功
                        var savePath = ret.savePath;
                        var songListID = id;
                        var title = titleName;
                        shareMp3Single(songListID, title, savePath);
                        // var savePath = '';
                        // shareMp3Single(songListID,title,savePath);
                        // shareMp3Album(name,listening_description,l_id);
                    } else {
                        // console.log(JSON.stringify(err));
                    }
                });
                dialogBox.close({
                    dialogName: 'actionMenu'
                });
                // alert(1);
            } else if (ret.index == "1") {
                var imgaesFx = host + '/' + smas;
                api.download({
                    url: imgaesFx,
                    savePath: 'fs://savePath/' + smas,
                    report: true,
                    cache: true,
                    allowResume: true
                }, function(ret, err) {
                    if (ret.state == 1) {
                        //下载成功
                        var savePath = ret.savePath;
                        var songListID = id;
                        var title = titleName;
                        initTimelineSingle(songListID, title, savePath);
                        // var savePath = '';
                        // shareMp3Single(songListID,title,savePath);
                        // shareMp3Album(name,listening_description,l_id);
                    } else {
                        // console.log(JSON.stringify(err));
                    }
                });
                dialogBox.close({
                    dialogName: 'actionMenu'
                });
                // alert(3);
            } else if (ret.index == "2") {
                var imgaesFx = host + '/' + smas;
                api.download({
                    url: imgaesFx,
                    savePath: 'fs://savePath/' + smas,
                    report: true,
                    cache: true,
                    allowResume: true
                }, function(ret, err) {
                    if (ret.state == 1) {
                        //下载成功
                        var savePath = ret.savePath;
                        var songListID = id;
                        var title = titleName;
                        fnQQZoneSingle(songListID, title, savePath);
                        // var savePath = '';
                        // shareMp3Single(songListID,title,savePath);
                        // shareMp3Album(name,listening_description,l_id);
                    } else {
                        // console.log(JSON.stringify(err));
                    }
                });
                dialogBox.close({
                    dialogName: 'actionMenu'
                });

            } else if (ret.index == "3") {
                var imgaesFx = host + '/' + smas;
                api.download({
                    url: imgaesFx,
                    savePath: 'fs://savePath/' + smas,
                    report: true,
                    cache: true,
                    allowResume: true
                }, function(ret, err) {
                    // console.log(JSON.stringify(ret));
                    if (ret.state == 1) {
                        //下载成功
                        var savePath = ret.savePath;
                        var songListID = id;
                        var title = titleName;
                        fnintnQQSingle(songListID, title, savePath);
                        // var savePath = '';
                        // shareMp3Single(songListID,title,savePath);
                        // shareMp3Album(name,listening_description,l_id);
                    } else {
                        // console.log(JSON.stringify(err));
                    }
                });
                dialogBox.close({
                    dialogName: 'actionMenu'
                });
                // alert(2);

            } else {
                dialogBox.close({
                    dialogName: 'actionMenu'
                });
            }
            // dialogBox.close({
            //     dialogName: 'alert'
            // })
            // alert(JSON.stringify(ret))

        });
        // alert(id);
    }
    //添加到听单
    function fnOpenAddListening(id) {
        api.openWin({
            name: 'addListening',
            url: './add_listening.html',
            pageParam: {
                songListID: id,
                ok: 'add_listening'
            }
        });
    }
</script>
