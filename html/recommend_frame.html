<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>孔孟之道--听单</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css" />
    <style>
        .fr {
            float: right;
        }

        .fl {
            float: left;
        }

        .p20px {
            padding: 0px 20px;
        }

        .clr {
            overflow: hidden;
        }

        .row {
            display: -webkit-box;
            display: -webkit-flex;
        }

        .col {
            -webkit-box-flex: 1;
            -webkit-flex: 1;
            flex: 1;
            margin: 0 5px;
            position: relative;
        }
        /* 听单推荐 */

        .hot>.hotC {
            position: relative;
            float: left;
            padding: 4px;
            box-sizing: border-box;
            background-clip: content-box;
            text-align: center;
            font-size: 20px;
            /*padding-top:10px;*/
        }

        .sectionTitle {
            margin-bottom: 10px;
        }

        .sectionTitle .TD_div {
            font-size: 18px;
            color: #1a1a1a;
        }

        .sectionTitle .more {
            color: #666;
            font-size: 14px;
        }

        .hotC>img {
            width: 100%;
            height: auto;
        }

        .listtitle {
            font-size: 10px;
            color: #000;
        }

        .recommend {
            width: 100%;
            margin-bottom: 10px;
        }

        .recommend_frame_img img {
            width: 100%;
        }

        .hdivider {
            width: 100%;
            height: 1px;
            background-color: #b2b2b2;
        }

        .egret-flex-item {
            display: -webkit-box;
            -webkit-box-align: center;
            height: 100px;
        }

        .egret-flex-items {
            display: -webkit-box;
            -webkit-box-align: center;
            height: 100px;
            width: 80%;
        }

        .egret-flex-item-logo {
            max-width: 80px;
            min-width: 80px;
            /*margin-left: 0.5em; margin-right: 0.2em;*/
            -webkit-box-flex: 1;
            -webkit-box-align: center;
        }

        .egret-flex-item-logo img {
            height: 60px;
            width: 60px;
            border-radius: 5px;
            -webkit-box-align: center;
            vertical-align: top;
        }

        .egret-flex-item-shelf {
            overflow: hidden;
            -webkit-box-flex: 2;
            -webkit-box-align: center;
        }

        .egret-flex-item-shelf div {
            text-overflow: ellipsis;
            white-space: nowrap;
            overflow: hidden;
            height: 22px;
            line-height: 22px;
            /*margin-top: 5px;*/
        }

        .egret-flex-item-shelf .egret-flex-item-shelf01 .span1 {
            font-size: 15px;
            color: #000;
        }

        .egret-flex-item-shelf .egret-flex-item-shelf02 .span2 {
            font-size: 12px;
            color: #ff3db8;
            margin: 0 5px;
        }

        .egret-flex-item-shelf .egret-flex-item-shelf01 .span3 {
            font-size: 12px;
            color: #ccc;
            vertical-align: top;
        }

        .egret-flex-item-shelf04 {
            width: 18%;
            text-align: right;
            -webkit-box-flex: 1;
            -webkit-box-align: center;
            height: 65px;
        }

        .egret-flex-item-shelf04 img {
            width: 20px;
            height: 20px;
        }

        .egret-flex-item-shelf .egret-flex-item-shelf02 {
            font-size: 12px;
            color: #ccc;
        }

        .egret-flex-item-shelf .egret-flex-item-shelf02 span {
            font-size: 13px;
            color: #000;
        }

        .egret-flex-item-shelf03 div {
            float: left;
            /*line-height: 20px;*/
            /*margin: 5px 3px;*/
        }

        .egret-flex-item-shelf03 div img {
            width: 12px;
            height: 12px;
            line-height: 12px;
            margin: 0 2px;
        }

        .egret-flex-item-shelf03 div span {
            line-height: 22px;
            vertical-align: top;
            font-size: 11px;
            color: #b2b2b2;
        }

        .egret-flex-item-shelf .egret-flex-item-redclassify {
            color: #E03F40;
            border: 1px solid #E03F40;
            font-size: inherit;
            padding: 0 0.1em;
            border-radius: 1px;
            margin-right: 5px;
            box-sizing: border-box;
        }

        #footer {
            width: 100%;
            height: 50px;
            line-height: 50px;
            text-align: center;
        }

        /*加载loading的样式css 到结束*/

        #loadEffect {
            position: fixed;
            top: 33.33%;
            left: calc((50%) - 25px);
        }

        .loadEffect {
            width: 50px;
            height: 50px;
            position: absolute;
            margin: 0 auto;
            /*margin-top:100px;*/
            /*position: fixed;*/
        }

        .loadEffect span {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #ccc;
            position: absolute;
            -webkit-animation: load 1.04s ease infinite;
        }

        @-webkit-keyframes load {
            0% {
                opacity: 1;
            }
            100% {
                opacity: 0.2;
            }
        }

        .loadEffect span:nth-child(1) {
            left: 0;
            top: 50%;
            margin-top: -4px;
            -webkit-animation-delay: 0.13s;
        }

        .loadEffect span:nth-child(2) {
            left: 7px;
            top: 7px;
            -webkit-animation-delay: 0.26s;
        }

        .loadEffect span:nth-child(3) {
            left: 50%;
            top: 0;
            margin-left: -4px;
            -webkit-animation-delay: 0.39s;
        }

        .loadEffect span:nth-child(4) {
            top: 7px;
            right: 7px;
            -webkit-animation-delay: 0.52s;
        }

        .loadEffect span:nth-child(5) {
            right: 0;
            top: 50%;
            margin-top: -4px;
            -webkit-animation-delay: 0.65s;
        }

        .loadEffect span:nth-child(6) {
            right: 7px;
            bottom: 7px;
            -webkit-animation-delay: 0.78s;
        }

        .loadEffect span:nth-child(7) {
            bottom: 0;
            left: 50%;
            margin-left: -4px;
            -webkit-animation-delay: 0.91s;
        }

        .loadEffect span:nth-child(8) {
            bottom: 7px;
            left: 7px;
            -webkit-animation-delay: 1.04s;
        }

    </style>
</head>

<body>
    <!-- <div class="recommend">
      <div class="recommend_frame_img"><img src="../image/index/KM_tp.jpg" alt=""></div>
  </div> -->
    <div class="p20px">

        <div id="ListOfExcellentWorks">

            <!-- <div class="hotC" onclick="fnSingleWin();">
                <img src="../image/frame0101cover/frame0101cover06.png" alt="" >
                <div class="listtitle">F3如意国学机</div>
            </div> -->

        </div>
        <div id="footer" class="disnone">
            暂无数据
        </div>
    </div>
    <!-- 加载loading的dom -->
    <div id="loadEffect"></div>
    <!-- ~~~~ -->
</body>

</html>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/common.js"></script>
<script type="text/javascript" src="../script/message.js"></script>
<script type="text/javascript" src="../script/swiper.min.js"></script>
<script type="text/javascript" src="../script/wxfx.js"></script>
<script type="text/javascript">
    var token;
    var p = 1;
    apiready = function() {


        token = $api.getStorage('token');
        // fnTingdanZhuanJi();
        fnGengDuo();
        api.setCustomRefreshHeaderInfo({
            bgColor: '#f0f0f0',
            image: {
                pull: [
                    'widget://image/Refresh/dropdown_anim_00.png',
                    'widget://image/Refresh/dropdown_anim_01.png',
                    'widget://image/Refresh/dropdown_anim_02.png',
                    'widget://image/Refresh/dropdown_anim_03.png',
                    'widget://image/Refresh/dropdown_anim_04.png',
                    'widget://image/Refresh/dropdown_anim_05.png',
                    'widget://image/Refresh/dropdown_anim_06.png',
                    'widget://image/Refresh/dropdown_anim_07.png',
                    'widget://image/Refresh/dropdown_anim_08.png',
                    'widget://image/Refresh/dropdown_anim_09.png',
                    'widget://image/Refresh/dropdown_anim_10.png',
                ],
                load: [
                    'widget://image/Refresh/dropdown_anim_00.png',
                    'widget://image/Refresh/dropdown_anim_01.png',
                    'widget://image/Refresh/dropdown_anim_02.png',
                    'widget://image/Refresh/dropdown_anim_03.png',
                    'widget://image/Refresh/dropdown_anim_04.png',
                    'widget://image/Refresh/dropdown_anim_05.png',
                ]
            }
        }, function() {
            //下拉刷新被触发，自动进入加载状态，使用 api.refreshHeaderLoadDone() 手动结束加载中状态
            //下拉刷新被触发，使用 api.refreshHeaderLoadDone() 结束加载中状态
            api.refreshHeaderLoadDone()
        });
        api.addEventListener({
            name: 'neiJianTingBFms'
        }, function(ret, err) {
            bofangmoshi = ret.value.bofangmoshiid;

            fnBoFangMoShiId(bofangmoshi);
            return;
        });
        api.addEventListener({
            name: 'scrolltobottom',
            extra: {
                threshold: -20 //设置距离底部多少距离时触发，默认值为0，数字类型
            }
        }, function(ret, err) {
            var footer = $api.byId('footer');
            $api.html(footer, '正在加载更多');
            p++;
            fnGengDuoss();
        });
    }
    var bofangmoshi;

    function fnBoFangMoShiId(bofangmoshiss) {
        bofangmoshi = bofangmoshiss;
    }

    function fnGengDuo() {
        var id = api.pageParam.id;
        uri = '/index/floor_more/' + id;
        api.ajax({
            url: host + apiUri + uri,
            method: 'get',
            dataType: 'json',
            timeout: 10,
            headers: {
                "source": api.systemType,
                "version": version,
                "session": token
            },
            data: {
                values: {
                    p: 1
                }
            }
        }, function(ret, err) {
            // alert(JSON.stringify(ret));
            if (ret) {
                if (ret.status == 200) {
                    if (ret.data.list) {
                        if (ret.data.list.length >= 10) {
                            var footer = $api.byId('footer');
                            $api.html(footer, '上拉加载更多');
                        } else {
                            var footer = $api.byId('footer');
                            $api.html(footer, '无更多数据');
                        }
                        if (ret.data.fllor_info.floor_type == "block") {
                            var footer = $api.byId('footer');
                            $api.css(footer, 'display:none');
                            var stylelist = $api.byId('ListOfExcellentWorks');

                            var html = '';
                            html += '<div class="hot" id="hot">';
                            for (var i = 0; i < ret.data.list.length; i++) {
                                if (ret.data.fllor_info.content_type == 'album') {
                                    html += '<div class="hotC" onclick="fnSingleWin(' + ret.data.list[i].id + ',\'' + ret.data.list[i].title + '\',\'' + ret.data.fllor_info.content_type + '\');"><img src=" ' + host + '/' + ret.data.list[i].big +
                                        '" alt=""><div class="listtitle"> ' + ret.data.list[i].title + '</div></div>';
                                } else if (ret.data.fllor_info.content_type == 'listening') {
                                    html += '<div class="hotC" onclick="fnSingleWin(' + ret.data.list[i].id + ',\'' + ret.data.list[i].title + '\',\'' + ret.data.fllor_info.content_type + '\');"><img src=" ' + listeningImg + '/' + ret.data.list[
                                            i].big +
                                        '" alt=""><div class="listtitle"> ' + ret.data.list[i].title + '</div></div>';
                                }

                            }
                            html += '</div>';
                            $api.html(stylelist, html);
                            var frameWidth = api.frameWidth;
                            var frameHeight = api.frameHeight;
                            var hotCs = $api.domAll('.hotC');
                            for (var j = 0; j < ret.data.list.length; j++) {
                                hotCs.item(j).style.width = (frameWidth - 40) / 3 + "px";
                                hotCs.item(j).style.height = (frameWidth - 40) / 3 * 1.224 + "px";
                            };
                        } else if (ret.data.fllor_info.floor_type == "list") {
                            var stylelist = $api.byId('ListOfExcellentWorks');
                            var html = '';
                            // console.log(JSON.stringify(ret));
                            var author_name;
                            for (var i = 0; i < ret.data.list.length; i++) {
                                if (ret.data.list[i].author_name == null) {
                                    author_name = '';
                                } else {
                                    author_name = ret.data.list[i].author_name;
                                }
                                html += '<div class="egret-flex-item"><div class="egret-flex-items" tapmode="fmbtnhover" onclick="fnOpenPlay(' + ret.data.list[i].id + ')"><div class="egret-flex-item-logo"><img src="' + host + '/' + ret.data.list[
                                        i].mid + '" alt="" class=""></div><div class="egret-flex-item-shelf"><div class="egret-flex-item-shelf01"><span class="span1 fl"><span>' + ret.data.list[i].title +
                                    '</span></span></div><div class="egret-flex-item-shelf02"><span>' +
                                    author_name +
                                    '</span></div><div class="egret-flex-item-shelf03"><div><img src="../image/KM_play.png" alt=""><span>' + ret.data.list[i].play_total +
                                    '</span></div><div><img src="../image/KM_zf.png" alt=""><span>' + ret.data.list[i].share_total + '</span></div><div><img src="../image/KM_dz.png" alt=""><span>' + ret.data.list[i].good_total +
                                    '</span></div></div></div></div><div class="egret-flex-item-shelf04" onclick="fnOpenPlayMore(' + ret.data.list[i].id + ',\'' + ret.data.list[i].floor_name + '\',\'' + ret.data.list[i].mid +
                                    '\')"><img src="../image/KM_list_more.png" alt=""></div></div><div class="hdivider"></div>';
                            }
                            $api.html(stylelist, html);
                        }
                        // fnRecommendedDirectory(ret);
                        // fnAlbumIdLift(ret);
                    } else {
                        var footer = $api.byId('footer');
                        $api.html(footer, '无更多数据');
                    }
                } else {
                    netMessage(ret);
                }
            } else {
                netWork(err);
            }
        });
    }

    function fnGengDuoss() {

        var id = api.pageParam.id;
        uri = '/index/floor_more/' + id;
        api.ajax({
            url: host + apiUri + uri,
            method: 'get',
            dataType: 'json',
            timeout: 10,
            headers: {
                "source": api.systemType,
                "version": version,
                "session": token
            },
            data: {
                values: {
                    p: p
                }
            }
        }, function(ret, err) {
            // alert(JSON.stringify(ret));
            if (ret) {
                if (ret.status == 200) {

                    // console.log(JSON.stringify(ret));
                    // console.log(JSON.stringify(p));
                    if (ret.data.list) {
                        if (ret.data.list.length > 10) {

                        } else {
                            var footer = $api.byId('footer');
                            $api.html(footer, '上拉加载更多');
                        }
                        if (ret.data.fllor_info.floor_type == "block") {
                            var footer = $api.byId('footer');
                            $api.css(footer, 'display:none');

                            // $api.html(footer, '正在加载更多');
                            var stylelist = $api.byId('ListOfExcellentWorks');
                            var html = '';
                            html += '<div class="hot" id="hot">';
                            for (var i = 0; i < ret.data.list.length; i++) {
                                if (ret.data.fllor_info.content_type == 'album') {
                                    html += '<div class="hotC" onclick="fnSingleWin(' + ret.data.list[i].id + ',\'' + ret.data.list[i].title + '\',\'' + ret.data.fllor_info.content_type + '\');"><img src=" ' + host + '/' + ret.data.list[i].big +
                                        '" alt=""><div class="listtitle"> ' + ret.data.list[i].title + '</div></div>';
                                } else if (ret.data.fllor_info.content_type == 'listening') {
                                    html += '<div class="hotC" onclick="fnSingleWin(' + ret.data.list[i].id + ',\'' + ret.data.list[i].title + '\',\'' + ret.data.fllor_info.content_type + '\');"><img src=" ' + listeningImg + '/' + ret.data.list[
                                            i].big +
                                        '" alt=""><div class="listtitle"> ' + ret.data.list[i].title + '</div></div>';
                                }

                            }
                            html += '</div>';
                            $api.html(stylelist, html);
                            // $api.append(stylelist,html);
                            var frameWidth = api.frameWidth;
                            var frameHeight = api.frameHeight;
                            var hotCs = $api.domAll('.hotC');
                            for (var j = 0; j < ret.data.list.length; j++) {
                                hotCs.item(j).style.width = (frameWidth - 40) / 3 + "px";
                                hotCs.item(j).style.height = (frameWidth - 40) / 3 * 1.224 + "px";
                            };
                        } else if (ret.data.fllor_info.floor_type == "list") {
                            var stylelist = $api.byId('ListOfExcellentWorks');
                            var html = '';
                            // console.log(JSON.stringify(ret));
                            var author_name;
                            for (var i = 0; i < ret.data.list.length; i++) {
                                if (ret.data.list[i].author_name == null) {
                                    author_name = '';
                                } else {
                                    author_name = ret.data.list[i].author_name;
                                }
                                html += '<div class="egret-flex-item"><div class="egret-flex-items" tapmode="fmbtnhover" onclick="fnOpenPlay(' + ret.data.list[i].id + ')"><div class="egret-flex-item-logo"><img src="' + host + '/' + ret.data.list[
                                        i].mid + '" alt="" class=""></div><div class="egret-flex-item-shelf"><div class="egret-flex-item-shelf01"><span class="span1 fl">作品：<span>' + ret.data.list[i].title +
                                    '</span></span></div><div class="egret-flex-item-shelf02"><span>' +
                                    author_name +
                                    '</span></div><div class="egret-flex-item-shelf03"><div><img src="../image/KM_play.png" alt=""><span>' + ret.data.list[i].play_total +
                                    '</span></div><div><img src="../image/KM_zf.png" alt=""><span>' + ret.data.list[i].share_total + '</span></div><div><img src="../image/KM_dz.png" alt=""><span>' + ret.data.list[i].good_total +
                                    '</span></div></div></div></div><div class="egret-flex-item-shelf04" onclick="fnOpenPlayMore(' + ret.data.list[i].id + ',\'' + ret.data.list[i].floor_name + '\',\'' + ret.data.list[i].mid +
                                    '\')"><img src="../image/KM_list_more.png" alt=""></div></div><div class="hdivider"></div>';
                            }
                            // $api.html(stylelist, html);
                            $api.append(stylelist, html);
                        }

                    } else {
                        var footer = $api.byId('footer');
                        $api.html(footer, '无更多数据');
                    }

                    // fnRecommendedDirectory(ret);
                    // fnAlbumIdLift(ret);
                } else {
                    netMessage(ret);
                }
            } else {
                netWork(err);
            }
        });
    }
    // function fnTingdanZhuanJi() {
    //     var id = api.pageParam.id;
    //     if (id == 1) {
    //         uri = '/album';
    //         api.ajax({
    //             url: host + apiUri + uri,
    //             method: 'get',
    //             dataType: 'json',
    //             headers: {
    //                 "source": api.systemType,
    //                 "version": version,
    //                 "session": token
    //             },
    //
    //         }, function(ret, err) {
    //             // alert(JSON.stringify(ret));
    //             if (ret.status == 200) {
    //                 // fnRecommendedDirectory(ret);
    //                 fnAlbumIdLift(ret);
    //             } else {
    //                 alert(ret.message);
    //             }
    //         });
    //     } else if (id == 2) {
    //         var stylelist = $api.byId('ListOfExcellentWorks');
    //         var html =
    //             '<div class="egret-flex-item"><div class="egret-flex-items" tapmode="fmbtnhover" onclick="fnOpenPlay()"><div class="egret-flex-item-logo"><img src="../image/KM_album.png" alt="" class=""></div><div class="egret-flex-item-shelf"><div class="egret-flex-item-shelf01"><span class="span1 fl">作品：<span>《沁园春·雪》</span></span><!-- <span class="span2 iconfont icon-nv fl"></span> --><!-- <img src="../image/js.png" alt="" class="fl"> --><!-- <span class="span3 fr">昨天21.30</span> --></div><div class="egret-flex-item-shelf02"><span>唐嫣</span><!-- <span><img src="../image/js.png" alt="" class="fl"></span> --></div><div class="egret-flex-item-shelf03"><div><img src="../image/KM_play.png" alt=""><span>100</span></div><!-- <div><img src="../image/KM_dx.png" alt=""><span>100</span></div> --><div><img src="../image/KM_zf.png" alt=""><span>100</span></div><div><img src="../image/KM_dz.png" alt=""><span>100</span></div></div></div></div><div class="egret-flex-item-shelf04" onclick="fnOpenPlayMore()"><img src="../image/KM_list_more.png" alt=""></div></div><div class="hdivider"></div>';
    //         $api.html(stylelist, html);
    //     }
    //
    // }
    // //接口  听单展示
    // function fnAlbumIdLift(data_) {
    //     var stylelist = $api.byId('hot');
    //     var html = '';
    //     for (var i = 0; i < data_.data.length; i++) {
    //         html += '<div class="hotC" onclick="fnSingleWin(' + data_.data[i].id + ');"><img src=" ' + host + '/' + data_.data[i].big + '" alt=""><div class="listtitle"> ' + data_.data[i].title + '</div></div>';
    //     }
    //     $api.html(stylelist, html);
    //     var frameWidth = api.frameWidth;
    //     var frameHeight = api.frameHeight;
    //     var hotCs = $api.domAll('.hotC');
    //     for (var j = 0; j < data_.data.length; j++) {
    //         hotCs.item(j).style.width = (frameWidth - 40) / 3 + "px";
    //         hotCs.item(j).style.height = (frameWidth - 40) / 3 * 1.224 + "px";
    //     };
    //
    // }

    function fnSingleWin(id, name, urlNames) {
        if (urlNames == 'listening') {
            urlName = 'ListingsList';
        } else if (urlNames == 'album') {
            urlName = 'single';
        }
        api.openWin({
            name: urlName,
            url: './' + urlName + '.html',
            pageParam: {
                albumId: id,
                ok: urlName,
                floor_name: name,
                ok: urlName
            }
        });

    }
    //打开更多页面
    function fnOpenPlayMore(ids, textName, mid) {
        var dialogBox = api.require('dialogBox');
        dialogBox.actionMenu({
            rect: {
                h: 150
            },
            texts: {
                cancel: '取消'
            },
            items: [{
                text: '收藏',
                icon: 'widget://image/KM_hxs.png'
            }, {
                text: '添加到听单',
                icon: 'widget://image/KM_play_add_gray.png'
            }, {
                text: '分享',
                icon: 'widget://image/KM_ListingsListGd.png'
            }],
            styles: {
                bg: '#FFF',
                column: 3,
                itemText: {
                    color: '#000',
                    size: 12,
                    marginT: 8
                },
                itemIcon: {
                    size: 30
                },
                cancel: {
                    bg: 'fs://icon.png',
                    color: '#000',
                    h: 44,
                    size: 14
                }
            },
            tapClose: true
        }, function(ret) {
            console.log(JSON.stringify(ret.index));
            if (ret.eventType == 'cancel') {
                dialogBox.close({
                    dialogName: 'actionMenu'
                });
            }
            if (ret.index == "0") {
                // 刚开始的时候加载loading
                var loadEffect = $api.byId('loadEffect');
                htmlloadEffect = '<div class="loadEffect"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></div>'
                $api.html(loadEffect, htmlloadEffect);

                uri = '/extra/list_collection/';
                api.ajax({
                    url: host + apiUri + uri + ids,
                    method: 'post',
                    dataType: 'json',
                    timeout: 10,
                    headers: {
                        "source": api.systemType,
                        "version": version,
                        "session": token
                    },
                    data: {
                        values: {
                            "model": 'book',
                        }
                    }
                }, function(ret, err) {
                    // 这个是关闭loading再掉通第一个接口的地方加
                    var loadEffect = $api.byId('loadEffect');
                    htmlloadEffect = '';
                    $api.html(loadEffect, htmlloadEffect);
                    // ~~~~~~~~~~~~~~
                    if (ret) {
                        if (ret.status == 200) {
                            api.toast({              
                                msg:   '收藏成功',
                                duration:  2000,
                                location:   'middle'          
                            });
                        } else {
                            netMessage(ret);
                        }
                    } else {
                        netWork(err);
                    }

                });
                dialogBox.close({
                    dialogName: 'actionMenu'
                });
            } else if (ret.index == "1") {
                fnOpenAddListening(ids);
                dialogBox.close({
                    dialogName: 'actionMenu'
                });
                // alert(2);
            } else if (ret.index == "2") {
                dialogBox.close({
                    dialogName: 'actionMenu'
                });
                fnOpenPlayShare(ids, textName, mid);

                // alert(3);
            } else {
                dialogBox.close({
                    dialogName: 'actionMenu'
                });
            }
            // dialogBox.close({
            //     dialogName: 'actionMenu'
            // })
            // alert(JSON.stringify(ret))

        });
    }
    // 添加听单
    function fnOpenAddListening(ids) {
        //   console.log(id);
        api.openWin({
            name: 'addListening',
            url: './add_listening.html',
            pageParam: {
                songListID: ids,
                ok: 'recommend_frame'
            }
        });
    }


    var Dqbofangid;
    var bofang;

    function fnDangQianbofangid(id, bofangs) {
        Dqbofangid = id;
        bofang = bofangs;
    }
    //作品列表进入播放页面
    function fnOpenPlay(a) {
        api.addEventListener({
            name: 'netbofangsssssss'
        }, function(ret, err) {
            if (a == ret.value.a) {
                fnDangQianbofangid(ret.value.a, ret.value.bofang);
            }
        });
        var playlistid = api.pageParam.albumId;
        if (Dqbofangid == a) {

            api.openWin({
                name: 'playDanQu',
                url: './playDanQu.html',
                pageParam: {
                    a: a,
                    // danQu:'danQu',
                    dangqianbofangid: Dqbofangid,
                    ok: 'playDanQu',
                    bofangmoshi: bofangmoshi,
                    bofang: bofang
                }
            });
        } else {

            api.openWin({
                name: 'playDanQu',
                url: './playDanQu.html',
                pageParam: {
                    a: a,
                    // danQu:'danQu',
                    ok: 'playDanQu',
                    bofangmoshi: bofangmoshi
                }
            });

        }

    }
    //打开分享
    function fnOpenPlayShare(ids, textName, mid) {
        // console.log(id);
        // console.log(sma);
        var dialogBox = api.require('dialogBox');
        dialogBox.actionMenu({
            rect: {
                h: 150
            },
            texts: {
                cancel: '取消'
            },
            items: [{
                text: '微信',
                icon: 'widget://image/weixin.png'
            }, {
                text: '朋友圈',
                icon: 'widget://image/friends.png'
            }, {
                text: 'QQ',
                icon: 'widget://image/qq.png'

            }, {
                text: 'QQ空间',
                icon: 'widget://image/QQkongjian.png'
            }],
            styles: {
                bg: '#FFF',
                column: 4,
                itemText: {
                    color: '#000',
                    size: 12,
                    marginT: 8
                },
                itemIcon: {
                    size: 30
                },
                cancel: {
                    bg: 'fs://icon.png',
                    color: '#000',
                    h: 44,
                    size: 14
                }
            },
            tapClose: true
        }, function(ret) {
            if (ret.eventType == 'cancel') {
                dialogBox.close({
                    dialogName: 'actionMenu'
                });
            }
            if (ret.index == "0") {
                var imgaesFx = host + '/' + mid;
                // console.log(imgaesFx);
                api.download({
                    url: imgaesFx,
                    savePath: 'fs:savePath/' + mid,
                    report: true,
                    cache: true,
                    allowResume: true
                }, function(ret, err) {
                    // console.log(JSON.stringify(ret));
                    if (ret.state == 1) {
                        //下载成功
                        var savePath = ret.savePath;
                        // console.log(savePath);
                        var songListID = ids;
                        var title = textName;
                        shareMp3Single(songListID, title, savePath);
                        // var savePath = '';
                        // shareMp3Single(songListID,title,savePath);
                        // shareMp3Album(name,listening_description,l_id);
                    } else {
                        // console.log(JSON.stringify(err));
                    }
                });
                dialogBox.close({
                    dialogName: 'actionMenu'
                });
                // alert(1);
            } else if (ret.index == "1") {
                var imgaesFx = host + '/' + mid;
                // console.log(imgaesFx);
                api.download({
                    url: imgaesFx,
                    savePath: 'fs:savePath/' + mid,
                    report: true,
                    cache: true,
                    allowResume: true
                }, function(ret, err) {
                    // console.log(JSON.stringify(ret));
                    if (ret.state == 1) {
                        //下载成功
                        var savePath = ret.savePath;
                        // console.log(savePath);
                        var songListID = ids;
                        var title = textName;
                        initTimelineSingle(songListID, title, savePath);
                        // var savePath = '';
                        // shareMp3Single(songListID,title,savePath);
                        // shareMp3Album(name,listening_description,l_id);
                    } else {
                        // console.log(JSON.stringify(err));
                    }
                });
                dialogBox.close({
                    dialogName: 'actionMenu'
                });
                // alert(3);
            } else if (ret.index == "2") {
                var imgaesFx = host + '/' + mid;
                // console.log(imgaesFx);
                api.download({
                    url: imgaesFx,
                    savePath: 'fs:savePath/' + mid,
                    report: true,
                    cache: true,
                    allowResume: true
                }, function(ret, err) {
                    // console.log(JSON.stringify(ret));
                    if (ret.state == 1) {
                        //下载成功
                        var savePath = ret.savePath;
                        // console.log(savePath);
                        var songListID = ids;
                        var title = textName;
                        fnQQZoneSingle(songListID, title, savePath);
                        // var savePath = '';
                        // shareMp3Single(songListID,title,savePath);
                        // shareMp3Album(name,listening_description,l_id);
                    } else {
                        // console.log(JSON.stringify(err));
                    }
                });
                dialogBox.close({
                    dialogName: 'actionMenu'
                });
                // alert(2);

            } else if (ret.index == "3") {
                var imgaesFx = host + '/' + mid;
                // console.log(imgaesFx);
                api.download({
                    url: imgaesFx,
                    savePath: 'fs:savePath/' + mid,
                    report: true,
                    cache: true,
                    allowResume: true
                }, function(ret, err) {
                    // console.log(JSON.stringify(ret));
                    if (ret.state == 1) {
                        //下载成功
                        var savePath = ret.savePath;
                        // console.log(savePath);
                        var songListID = ids;
                        var title = textName;
                        fnintnQQSingle(songListID, title, savePath);
                        // var savePath = '';
                        // shareMp3Single(songListID,title,savePath);
                        // shareMp3Album(name,listening_description,l_id);
                    } else {
                        // console.log(JSON.stringify(err));
                    }
                });
                dialogBox.close({
                    dialogName: 'actionMenu'
                });
                // alert(2);
            } else {
                dialogBox.close({
                    dialogName: 'actionMenu'
                });
            }
            // dialogBox.close({
            //     dialogName: 'alert'
            // })
            // alert(JSON.stringify(ret))

        });
        // alert(id);
    }
</script>
