<!DOCTYPE html>
  <html>
  <head>
      <meta charset="utf-8">
      <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
      <title>孔孟之道--热听榜</title>
      <link rel="stylesheet" type="text/css" href="../css/api.css"/>
      <style>
        body,html{
          background-color: #f2f2f2;
        }
        .row {
            display: -webkit-box;
            display: -webkit-flex;
        }

        .col {
            -webkit-box-flex: 1;
            -webkit-flex: 1;
            flex: 1;
            margin: 0 5px;
            position: relative;
        }
        .fr {
            float: right;
        }
        .fl {
            float: left;
        }
        .clear{
          clear:both;
        }
        .hdivider {
            width: 100%;
            height: 1px;
            background-color: #ccc;
        }
        section{
          width:100%;
          /*text-align: center;*/
          /*margin: 0 auto;*/
          background-color: #f2f2f2;
        }
        .egret-flex-item {
            display: -webkit-box;
            -webkit-box-align: center;
            height: 100px;
            background-color: #fff;
        }
        .egret-flex-items {
            display: -webkit-box;
            -webkit-box-align: center;
            height: 100px;
            width:80%;
        }
        .egret-flex-item-logo {
            max-width: 80px;
            min-width: 80px;
            margin-left: 0.5em;
            margin-right: 0.2em;
            -webkit-box-flex: 1;
            -webkit-box-align: center;
        }
        .egret-flex-item-logo img {
            height: 80px;
            width: 80px;
            -webkit-box-align: center;
            vertical-align: top;
        }
        .egret-flex-item-shelf {
            overflow: hidden;
            -webkit-box-flex: 2;
            -webkit-box-align: center;
            height: 80px;
            line-height: 30px;
            padding-left: 20px;
        }

        .egret-flex-item-shelf div {
            text-overflow: ellipsis;
            white-space: nowrap;
            overflow: hidden;
            margin-top: 5px;
        }

        .egret-flex-item-shelf .egret-flex-item-shelf01 .span1 {
            font-size: 15px;
            color:#000;
        }

        .egret-flex-item-shelf .egret-flex-item-shelf01 .span2 {
            font-size: 15px;
            color: #ff3db8;
            margin: 0 5px;
        }
        .egret-flex-item-shelf .egret-flex-item-shelf01 .span3 {
            font-size: 14px;
            color: #000;
            margin-right: 10px;
        }

        .egret-flex-item-shelf .egret-flex-item-shelf02 {
            font-size: 15px;
            /*color: #666;*/
                color: #000;
        }

        /*.egret-flex-item-shelf .egret-flex-item-shelf02 span {
            font-size: 15px;
            color: #000;
        }*/

        .egret-flex-item-shelf03 div {
            float: left;
            line-height: 20px;
            margin: 5px 1px;
        }

        .egret-flex-item-shelf03 div img {
            width: 15px;
            height: 15px;
            line-height: 15px;
            margin: 0 2px;
        }

        .egret-flex-item-shelf03 div span {
            line-height: 18px;
            vertical-align: top;
            font-size:14px;
            color:#b2b2b2;
        }

        .egret-flex-item-shelf .egret-flex-item-redclassify {
            color: #E03F40;
            border: 1px solid #E03F40;
            font-size: inherit;
            padding: 0 0.1em;
            border-radius: 1px;
            margin-right: 5px;
            box-sizing: border-box;
        }
        .fmbtnhover {
            background: #D8D9DA;
        }
        .egret-flex-item-shelf04{
          width:18%;
          text-align: right;
          -webkit-box-flex: 1;
          -webkit-box-align: center;
          height: 70px;
          padding-right: 10px;
        }
        .egret-flex-item-shelf04 img{
          width: 20px;
          height: 20px;
        }
      </style>
  </head>
  <body>
    <section id="section">
      <!-- <div class="egret-flex-item" >
        <div class="egret-flex-items" tapmode="fmbtnhover" onclick="fnOpenPlay()">
          <div class="egret-flex-item-shelf">
              <div class="egret-flex-item-shelf02">三字经1</div>
              <div class="egret-flex-item-shelf03">
                  <div><img src="../image/KM_play.png" alt=""><span>100</span></div>
                  <div><img src="../image/KM_zf.png" alt=""><span>100</span></div>
                  <div><img src="../image/KM_dz.png" alt=""><span>100</span></div>
              </div>
          </div>
        </div>
        <div class="egret-flex-item-shelf04" onclick="fnOpenPlayMore()">
          <img src="../image/KM_list_more.png" alt="">
        </div>
      </div>
      <div class="hdivider"></div>
      <div class="egret-flex-item" >
        <div class="egret-flex-items" tapmode="fmbtnhover" onclick="fnOpenPlay()">
          <div class="egret-flex-item-shelf">
              <div class="egret-flex-item-shelf02"> 三字经1</div>
              <div class="egret-flex-item-shelf03">
                  <div><img src="../image/KM_play.png" alt=""><span>100</span></div>
                  <div><img src="../image/KM_zf.png" alt=""><span>100</span></div>
                  <div><img src="../image/KM_dz.png" alt=""><span>100</span></div>
              </div>
          </div>
        </div>
        <div class="egret-flex-item-shelf04" onclick="fnOpenPlayMore()">
          <img src="../image/KM_list_more.png" alt="">
        </div>
      </div>
      <div class="hdivider"></div>
      <div class="egret-flex-item" >
        <div class="egret-flex-items" tapmode="fmbtnhover" onclick="fnOpenPlay()">
          <div class="egret-flex-item-shelf">
              <div class="egret-flex-item-shelf02"> 三字经1</div>
              <div class="egret-flex-item-shelf03">
                  <div><img src="../image/KM_play.png" alt=""><span>100</span></div>
                  <div><img src="../image/KM_zf.png" alt=""><span>100</span></div>
                  <div><img src="../image/KM_dz.png" alt=""><span>100</span></div>
              </div>
          </div>
        </div>
        <div class="egret-flex-item-shelf04" onclick="fnOpenPlayMore()">
          <img src="../image/KM_list_more.png" alt="">
        </div>
      </div>
      <div class="hdivider"></div>
      <div class="egret-flex-item" >
        <div class="egret-flex-items" tapmode="fmbtnhover" onclick="fnOpenPlay()">
          <div class="egret-flex-item-shelf">
              <div class="egret-flex-item-shelf02"> 三字经1</div>
              <div class="egret-flex-item-shelf03">
                  <div><img src="../image/KM_play.png" alt=""><span>100</span></div>
                  <div><img src="../image/KM_zf.png" alt=""><span>100</span></div>
                  <div><img src="../image/KM_dz.png" alt=""><span>100</span></div>
              </div>
          </div>
        </div>
        <div class="egret-flex-item-shelf04" onclick="fnOpenPlayMore()">
          <img src="../image/KM_list_more.png" alt="">
        </div>
      </div>
      <div class="hdivider"></div>
      <div class="egret-flex-item" >
        <div class="egret-flex-items" tapmode="fmbtnhover" onclick="fnOpenPlay()">
          <div class="egret-flex-item-shelf">
              <div class="egret-flex-item-shelf02"> 三字经1</div>
              <div class="egret-flex-item-shelf03">
                  <div><img src="../image/KM_play.png" alt=""><span>100</span></div>
                  <div><img src="../image/KM_zf.png" alt=""><span>100</span></div>
                  <div><img src="../image/KM_dz.png" alt=""><span>100</span></div>
              </div>
          </div>
        </div>
        <div class="egret-flex-item-shelf04" onclick="fnOpenPlayMore()">
          <img src="../image/KM_list_more.png" alt="">
        </div>
      </div>
      <div class="hdivider"></div>
      <div class="egret-flex-item" >
        <div class="egret-flex-items" tapmode="fmbtnhover" onclick="fnOpenPlay()">
          <div class="egret-flex-item-shelf">
              <div class="egret-flex-item-shelf02"> 三字经1</div>
              <div class="egret-flex-item-shelf03">
                  <div><img src="../image/KM_play.png" alt=""><span>100</span></div>
                  <div><img src="../image/KM_zf.png" alt=""><span>100</span></div>
                  <div><img src="../image/KM_dz.png" alt=""><span>100</span></div>
              </div>
          </div>
        </div>
        <div class="egret-flex-item-shelf04" onclick="fnOpenPlayMore()">
          <img src="../image/KM_list_more.png" alt="">
        </div>
      </div>
      <div class="hdivider"></div> -->
    </section>
  </body>
  <script type="text/javascript" src="../script/api.js"></script>
  <script type="text/javascript" src="../script/common.js"></script>
  <script type="text/javascript" src="../script/message.js"></script>;
  <script type="text/javascript">
  var token;
    apiready = function(){
      token = $api.getStorage('token');
      fnOpenHot();
    };
    //调接口
    function fnOpenHot(){
      api.ajax({
          url: host + apiUri + '/index/billboard' + '?type=hot',
          method: 'get',
          dataType: 'json',
          timeout:10,
          headers: {
              "source": api.systemType,
              "version": version,
              "session": token
          }
      }, function(ret, err) {
          // console.log(JSON.stringify(ret));
          if(ret){
            if (ret.status == 200) {
                var len= ret.data.length;
                // console.log(len);
                var html2 = '';
                var section = $api.byId('section');
                for(var i = 0; i < len; i++){
                  html2 += '<div class="egret-flex-item" >'+
                    '<div class="egret-flex-items" tapmode="fmbtnhover" onclick="fnOpenPlay('+ret.data[i].id+')">'+
                      '<div class="egret-flex-item-shelf">'+
                          '<div class="egret-flex-item-shelf02">'+ret.data[i].title+'</div>'+
                          '<div class="egret-flex-item-shelf03">'+
                              '<div><img src="../image/KM_play.png" alt=""><span>'+ret.data[i].play_total+'</span></div>'+
                              '<div><img src="../image/KM_zf.png" alt=""><span>'+ret.data[i].share_total+'</span></div>'+
                              '<div><img src="../image/KM_dz.png" alt=""><span>'+ret.data[i].good_total+'</span></div>'+
                          '</div>'+
                      '</div>'+
                    '</div>'+
                    '<div class="egret-flex-item-shelf04" onclick="fnOpenPlayMore()">'+
                      '<img src="../image/KM_list_more.png" alt="">'+
                    '</div>'+
                  '</div>'+
                  '<div class="hdivider"></div>';
                  $api.html(section,html2);
                }
            } else {
                netMessage(ret);
            }

          }else{
            netWork(err);
          }

      });
    }
    //打开播放
    function fnOpenPlay(id) {
      api.openWin({
          name: 'playDanQu',
          url: './playDanQu.html',
          pageParam: {
            a: id,
            ok: 'playDanQu'
          }
      });
    }
    //打开更多
    function fnOpenPlayMore() {
        var dialogBox = api.require('dialogBox');
        dialogBox.actionMenu({
            rect: {
                h: 150
            },
            texts: {
                cancel: '取消'
            },
            items: [{
                text: '收藏',
                icon: 'widget://image/KM_hxs.png'
            }, {
                text: '添加到听单',
                icon: 'widget://image/KM_play_add_gray.png'
            }, {
                text: '分享',
                icon: 'widget://image/KM_ListingsListGd.png'
            }],
            styles: {
                bg: '#FFF',
                column: 3,
                itemText: {
                    color: '#000',
                    size: 12,
                    marginT: 8
                },
                itemIcon: {
                    size: 30
                },
                cancel: {
                    bg: 'fs://icon.png',
                    color: '#000',
                    h: 44,
                    size: 14
                }
            },
            tapClose: true
        }, function(ret) {
            if (ret.eventType == 'cancel') {
                dialogBox.close({
                    dialogName: 'actionMenu'
                });
            }
            if (ret.index == "0") {
                api.toast({
                    msg: '收藏成功',
                    duration: 2000,
                    location: 'middle'
                });
                dialogBox.close({
                    dialogName: 'actionMenu'
                });
                // alert(1);
            } else if (ret.index == "1") {
                fnOpenAddListening();
                dialogBox.close({
                    dialogName: 'actionMenu'
                });
                // alert(2);
            } else if (ret.index == "2") {
                fnOpenPlayShare();
                dialogBox.close({
                    dialogName: 'actionMenu'
                });
                // alert(3);
            }else {
                dialogBox.close({
                    dialogName: 'actionMenu'
                });
            }
            dialogBox.close({
                dialogName: 'actionMenu'
            })
            // alert(JSON.stringify(ret))

        });
    }

    //打开分享
    function fnOpenPlayShare() {
        var dialogBox = api.require('dialogBox');
        dialogBox.actionMenu({
            rect: {
                h: 150
            },
            texts: {
                cancel: '取消'
            },
            items: [{
                text: '微信',
                icon: 'widget://image/weixin.png'
            }, {
                text: 'QQ',
                icon: 'widget://image/qq.png'
            }, {
                text: '朋友圈',
                icon: 'widget://image/friends.png'
            }],
            styles: {
                bg: '#FFF',
                column: 3,
                itemText: {
                    color: '#000',
                    size: 12,
                    marginT: 8
                },
                itemIcon: {
                    size: 30
                },
                cancel: {
                    bg: 'fs://icon.png',
                    color: '#000',
                    h: 44,
                    size: 14
                }
            },
            tapClose: true
        }, function(ret) {
            if (ret.eventType == 'cancel') {
                dialogBox.close({
                    dialogName: 'actionMenu'
                });
            }
            if (ret.index == "0") {
                dialogBox.close({
                    dialogName: 'actionMenu'
                });
                // alert(1);
            } else if (ret.index == "1") {
                dialogBox.close({
                    dialogName: 'actionMenu'
                });
                // alert(2);
            } else if (ret.index == "2") {
                dialogBox.close({
                    dialogName: 'actionMenu'
                });
                // alert(3);
            } else {
                dialogBox.close({
                    dialogName: 'alert'
                });
            }
            dialogBox.close({
                dialogName: 'actionMenu'
            })
            // alert(JSON.stringify(ret))

        });
    }
    //添加到听单
    function fnOpenAddListening(){
      api.openWin({
          name: 'addListening',
          url: './add_listening.html',
          pageParam: {
              ok: 'add_listening'
          }
      });
    }

  </script>
  </html>
