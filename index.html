<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>底部导航</title>
    <link rel="stylesheet" type="text/css" href="./css/api.css" />
    <link rel="stylesheet" type="text/css" href="./css/style.css" />
    <link rel="stylesheet" href="./css/iconfont/iconfont.css">
    <link rel="stylesheet" href="./css/iconfont.css">
    <style>
        .hr01,
        .hr02 {
            height: 28px;
        }

        .headerico {
            padding: 11px 15px 11px 15px;
        }

        .headericohover {
            background: #DADDE0;
        }

        .fr {
            float: right;
        }

        .fl {
            float: left;
        }

        .pa {
            position: absolute;
        }

        img {
            /*vertical-align: top;*/
        }

        header {
            background-color: #89211b;
            padding-top: 10px;
            position: relative;
            z-index: 1;
        }

        header ul li {
            display: none;
        }

        header ul li.active {
            display: block;
        }

        .activebar_p20px {
            padding: 0 20px;
        }

        .topbar {
            background: #89211b;
            height: 50px;
            position: relative;
            display: -webkit-box;
            -webkit-box-orient: horizontal;
            text-align: center;
            line-height: 50px;
            clear: both;
        }

        .egret-header-box {
            height: 50px;
            background-color: #89211b;
        }

        .egret-img-x {
            text-align: left;
        }

        .egret-img img {
            height: 30px;
            padding: 10px;
        }

        .egret-img-x img {
            width: 30px;
            vertical-align: middle;
        }

        .egret-img-a img {
            width: 30px;
            display: block;
            /*margin-top: 7.5px;*/
        }

        .left_img {
            position: absolute;
            left: 0;
            bottom: 9.5px;
        }

        .right_img {
            position: absolute;
            right: 0;
            bottom: 9.5px;
        }

        .egret-img-s {
            text-align: right;
        }

        .egret-img-s img {
            width: 25px;
            height: 25px;
            vertical-align: middle;
        }

        .egret-div {
            -webkit-box-flex: 1;
            color: #fff;
        }

        .egret-header-search {
            background-color: white;
            /*#781711*/
            height: 36px;
            position: relative;
            top: 7px;
            border-radius: 4px;
            margin: auto;
        }

        .egret-header-search img {
            /*margin-left: 30px;*/
            height: 20px;
            margin-top: 7px;
        }

        .egret-header-search span {
            height: 36px;
            line-height: 40px;
            /*width: 150px;*/
            width: 150px;
            font-size: 14px;
            color: #ccc;
            vertical-align: top;
        }

        .egret-header-search input:focus {
            /*border:0;*/
            outline: none;
        }

        .faxian {
            font-size: 18px;
        }

        .friend-tit {
            font-size: 18px;
            color: #fff;
            text-align: center;
            height: 50px;
            line-height: 50px;
        }

        #footer {
            background-color: #fff;
            height: 50px;
            /*padding: 0 10px;*/
        }

        #footer ul li {
            background-position: center;
            background-repeat: no-repeat;
            background-size: contain;
            text-align: center;
            padding-top: 30px;
            background: url() no-repeat center 2px;
            background-size: auto 23px;
            font-size: 11px;
        }

        #footer ul li.active {
            color: #89211b;
        }

        #footer ul li:nth-child(1) {
            background-image: url(./image/index/footer_sy.png);
        }

        #footer ul li:nth-child(2) {
            background-image: url(./image/index/footer_fx.png);
        }

        #footer ul li:nth-child(3) {}

        #footer ul li:nth-child(4) {
            background-image: url(./image/index/footer_gy.png);
        }

        #footer ul li:nth-child(5) {
            background-image: url(./image/index/footer_wd.png);
        }

        #footer ul li:nth-child(1).active {
            background-image: url(./image/index/footer_sys.png);
        }

        #footer ul li:nth-child(2).active {
            background-image: url(./image/index/footer_fxs.png);
        }

        #footer ul li:nth-child(3).active {}

        #footer ul li:nth-child(4).active {
            background-image: url(./image/index/footer_gys.png);
        }

        #footer ul li:nth-child(5).active {
            background-image: url(./image/index/footer_wds.png);
        }

        .flex-con {
            /*overflow: auto*/
            overflow: hidden;
        }

        .header_center {
            margin: 0 auto;
            width: 100%;
            height: 50px;
            line-height: 50px;
            text-align: center;
            font-size: 20px;
            /*color: #000;*/
        }

        .header_fr {
            width: 30px;
            height: 30px;
            padding: 10px 20px 10px 10px;
            line-height: 30px;
            font-size: 15px;
            color: #fff;
            position: absolute;
            right: 5px;
            bottom: -0px;
            /*display: inline-block;*/
            /*display: none;*/
        }

        .header_fr img {
            width: 100%;
        }

        .clear {
            clear: both;
        }

        .topbars {
            position: relative;
            height: 50px;
            line-height: 50px;
        }

        .egret-img-a-my span {
            text-align: right;
            width: 100%;
            display: block;
            position: absolute;
            right: 30px;
            line-height: 50px;
            font-size: 12px;
            color: #ccc;
        }

        .num {
            position: absolute;
            top: 5px;
            left: 18px;
            width: 14px;
            height: 14px;
            line-height: 14px;
        }

        .num p {
            width: 14px;
            height: 14px;
            border-radius: 7px;
            background-color: #f00;
            border: 1px solid #fff;
            text-align: center;
            font-size: 12px;
            color: #fff;
        }
    </style>
</head>

<body>
    <div id="wrap" class="flex-wrap flex-vertical">
        <header id="secHeader">
            <ul>
                <li class="active">
                    <div class="activebar_p20px">
                        <div class="topbar normalHeader">
                            <div class="egret-header-box egret-img-a egret-div " tapmode onclick="openMessage()">
                                <img class="left_img" src="./image/index/KM_xiaoxi.png" alt="">
                                <div class="num" id="num">

                                </div>
                            </div>
                            <div class="egret-header-box egret-div">
                                <div class="egret-header-search">
                                    <img src="./image/header_search.png" alt="">
                                    <span tapmode onclick="OpenSearch();">请输入关键词搜索</span>
                                </div>
                            </div>
                            <div class="egret-header-box egret-img-a egret-div" tapmode onclick="fnDenglu();"><img class="right_img" src="./image/index/KM_qiandao.png" alt=""></div>
                        </div>
                    </div>
                </li>
                <li class="">
                    <div class="activebar_p20px">
                        <div class="topbar normalHeader">
                            <div class="egret-header-box egret-img-x egret-div " tapmode onclick="openMessage()"></div>
                            <div class="egret-header-box egret-div faxian">
                                发现
                            </div>
                            <div class="egret-header-box egret-img-s egret-div" tapmode></div>
                        </div>
                    </div>
                </li>
                <li class="">开发</li>
                <li class="">
                    <div class="friend-tit egret-header-box egret-div">
                        朗诵
                        <div class="header_fr" onclick="fnAlert();" id="Bullet">
                            <img src="./image/index/246274041330857389.png" alt="">
                        </div>
                    </div>
                </li>
                <li class="">
                    <div class="activebar_p20px">
                        <div class="topbars normalHeader">

                            <div class="egret-img-a egret-img-a-my" tapmode onclick="fnDenglu();"><img class="right_img" src="./image/index/KM_qiandao.png" alt="">
                                <span id="lianxuqiandao">
                              <!-- 暂无签到 -->
                            </span>
                            </div>

                        </div>
                    </div>
                </li>

            </ul>
        </header>
        <div id="main" class="flex-con">

        </div>
        <div id="footer">
            <ul class="flex-wrap">
                <li tapmode="hover" onclick="randomSwitchBtn( this );" class="flex-con  active">首页</li>
                <li tapmode="hover" onclick="randomSwitchBtn( this );" class="flex-con ">发现</li>
                <li tapmode="hover" onclick="randomSwitchBtn( this );" class="flex-con"></li>
                <li tapmode="hover" onclick="randomSwitchBtn( this );" class="flex-con ">朗诵</li>
                <li tapmode="hover" onclick="randomSwitchBtn( this );" class="flex-con ">我的</li>
            </ul>
        </div>
    </div>
    <!-- <div class="centerVideo" id="centerVideo">
        <a class="videoButton"></a>
    </div> -->
    <div id="yinpin">
        <audio id="myAudio" >
    </audio>
    </div>
</body>

</html>
<script type="text/javascript" src="script/api.js"></script>
<script type="text/javascript" src="script/common.js"></script>
<script type="text/javascript" src="script/message1.js"></script>
<script type="text/javascript" src="script/indexCommon.js"></script>
<script type="text/javascript" src="script/indexDanQuCommon.js"></script>
<script type="text/javascript" src="script/indexXunTingCommon.js"></script>
<script type="text/javascript" src="script/indexCaoGaoCommon.js"></script>
<script type="text/javascript" src="script/index.js"></script>
<script type="text/javascript">
 var token; var a; var playUrli; var playgedan; var play; var timer2; var timer1; var historyUrlArray; var y; var rets; var shunxuplays; var danquplays; var suijiplays; var bofangmoshiid; var playTime; var a; var bofang; var playlistid; var dataArray
= new Array(); var caogaoId; var caogaoTitle; var caogaoName; var caogaoBody; var author_id; var DangQianbofangid; var titlename; var desc; var singerName; var reciter; var comment_total; var is_collection; var caogaoAuthor_id; var bookId; var danQu;
var minuteFollow; var cover_big;var footerIP; var playType;
var index0ssss;
    apiready = function() {
      // $api.clearStorage();

            var user_id = $api.getStorage('user_id');
            var nick_name = $api.getStorage('nick_name');
            var photo = $api.getStorage('photo');
            var login_way = $api.getStorage('login_way');
            // api.removePrefs({
            //     key: 'cgxlist'
            // });
            api.addEventListener({
                name: 'loginUser'
            }, function(ret, err) {
              randomSwitchBtn();
            });


            var secHeader = $api.byId('secHeader');
            $api.fixStatusBar(secHeader);
            var headeris = document.querySelector('#secHeader');
            $api.fixIos7Bar(headeris);
            $api.fixStatusBar(headeris);
            var footer = $api.byId('footer');
            var headerH = $api.offset(secHeader).h;
            var footerH = $api.offset(footer).h;
            footerIP = $api.fixTabBar($api.byId('footer'));
            fnOpenCenterFrame();
            api.parseTapmode();
            initEventListenner();
            initEventListennerBofang();
            initEventListennerBoFangMoshi();
            initEventListennerBofangDanQu();
            initEventListennerBoFangMoshiDanQu();
            initEventListennerShouCangXunTing();
            initEventListennerBofangXunTing();
            initEventListennerBoFangCaoGaoXiangMoshi();
            initEventListennerBofangCaoGaoXiang();
            fnJianTing();
            adjust();
            funIniGroup();
            // var dqian = $api.getStorage('qiandaoshu');
            // if(dqian){
            //   var stylelist = $api.byId('lianxuqiandao');
            //   var html ='已连续签到 '+ dqian +' 天';
            //   $api.html(stylelist, html);
            // }
            fuLianXuQianDao();

            // api.addEventListener({
            //     name: 'personalPrivateFrameIndex'
            // }, function(ret, err) {
            //   console.log(111);
            //   fnNum();
            // });
            //
            // api.addEventListener({
            //     name: 'personalPrivateFrameIndex2'
            // }, function(ret, err) {
            //   console.log(222);
            //   fnNum();
            // });

            api.addEventListener({
                name: 'personalPrivateFrame'
            }, function(ret, err) {
              fnNum();

            });

        }

        // 底部导航播放按钮；
    function fnOpenCenterFrame() {
        if (a) {
            api.openFrame({
                name: 'centerFrame',
                url: './html/center_frame.html',
                rect: {
                    x: (api.frameWidth - 45) / 2,
                    y: api.frameHeight - footerIP,
                    w: 45,
                    h: 50
                },
                customRefreshHeader: 'UIPullRefreshFlash',
                bounces: true,
                bgColor: 'rgba(0,0,0,0)',
                vScrollBarEnabled: false,
                hScrollBarEnabled: false,
            });
        } else {
            api.openFrame({
                name: 'centerFrame',
                url: './html/center_frame.html',
                rect: {
                    x: (api.frameWidth - 45) / 2,
                    y: api.frameHeight - footerIP,
                    w: 45,
                    h: 50,
                },
                pageParam: {
                    name: 'test'
                },
                bounces: false,
                bgColor: 'rgba(0,0,0,0)',
                vScrollBarEnabled: false,
                hScrollBarEnabled: false,
            });
        }
    }
    //打开消息页面
    function openMessage() {
        var token = $api.getStorage('token');
        if (token) {
            api.openWin({
                name: 'message',
                url: './html/message.html',
            });
        }else {
            api.openWin({
                name: 'token',
                url: './html/token.html',
                slidBackEnabled:false,
                reload: true,
                animation: {
                 type:"none",
                 subType:"from_right",
                 duration:300
               },
            });
        }

    };
    // 打开历史页面
    function openHistorys() {
        var token = $api.getStorage('token');
        if (token) {
            api.openWin({
                name: 'historys',
                url: './html/historys.html',
            });
        }else {
            api.openWin({
                name: 'token',
                url: './html/token.html',
                slidBackEnabled:false,
                reload: true,
                animation: {
                 type:"none",
                 subType:"from_right",
                 duration:300
               },
            });
        }

    }
    // 打开朗诵页面
    function fnReadWin() {
        var token = $api.getStorage('token');
        if (token) {
            api.openWin({
                name: 'read',
                url: './html/read.html',
            });
        }else {
            api.openWin({
                name: 'token',
                url: './html/token.html',
                slidBackEnabled:false,
                reload: true,
                animation: {
                 type:"none",
                 subType:"from_right",
                 duration:300
               },
            });
        }

    }

    // 熏听页面
    function fnListenWin() {
        var token = $api.getStorage('token');
        if (token) {
            api.openWin({
                name: 'listen',
                url: './html/listen.html',
            });
        }else {
            api.openWin({
                name: 'token',
                url: './html/token.html',
                slidBackEnabled:false,
                reload: true,
                animation: {
                 type:"none",
                 subType:"from_right",
                 duration:300
               },
            });
        }

    }
    // 底部导航
    function funIniGroup() {
        var qqziliao = api.pageParam.qqziliao;
        var eHeaderLis = $api.domAll('header li'),
            frames = [];
        for (var i = 0, len = eHeaderLis.length; i < len; i++) {
              frames.push({
                  name: 'indexFrame' + i,
                  url: './html/index_frame' + i + '.html',
                  bgColor: 'rgba(0,0,0,.2)',
                  pageParam: {
                      name: 'test',
                      qqziliao: qqziliao
                  },
                  bounces: false,
                  historyGestureEnabled:false,
              })
            }



        api.openFrameGroup({
            name: 'group',
            scrollEnabled: false,
            rect: {
                x: 0,
                y: $api.dom('header').offsetHeight,
                w: api.winWidth,
                h: $api.dom('#main').offsetHeight
            },
            index: 0,
            frames: frames,
        }, function(ret, err) {

        });
    }
    // 随意切换按钮
    function randomSwitchBtn(tag) {
        if (tag == $api.dom('#footer li.active')) return;
        var eFootLis = $api.domAll('#footer li'),
            eHeaderLis = $api.domAll('header li'),
            index = 0;
        for (var i = 0, len = eFootLis.length; i < len; i++) {
            if (i == 0) {
                fnNum();
            }
            if (i == 4) {
              api.sendEvent({
                  name: 'indexFrame4',
                  extra: {
                      indexFrame4: 'indexFrame4'
                  }
              });
            }

            if (tag == eFootLis[i]) {
                index = i;
            } else {
                $api.removeCls(eFootLis[i], 'active');
                $api.removeCls(eHeaderLis[i], 'active');
            }
        }
        $api.addCls(eFootLis[index], 'active');
        $api.addCls(eHeaderLis[index], 'active');
        api.setFrameGroupIndex({
            name: 'group',
            index: index
        });
    }

    //签到
    function fnDenglu() {
      var token = $api.getStorage('token');
      if (token) {
        var  uri = '/user/sign';
          api.ajax({
              url: host + apiUri + uri,
              method: 'post',
              dataType: 'json',
              timeout:10,
              headers: {
                  "source": api.systemType,
                  "version": version,
                  "session": token,
              },
          }, function(ret, err) {
            // console.log(JSON.stringify(ret));
            if(ret){
              if (ret.status == 200) {
                  api.toast({
                      msg: '签到成功,已连续签到'+ ret.data.sign_count +' 天',
                      duration: 2000,
                      location: 'middle'
                  });
                  var stylelist = $api.byId('lianxuqiandao');
                  var html ='已连续签到 '+ ret.data.sign_count +' 天';
                  $api.html(stylelist, html);
              } else {
                  netMessage(ret);
              }
            }else{
              // console.log(JSON.stringify(err));
              netWork(err);

              }
          });
      }else {
        api.toast({
            msg: '签到需要登陆之后才能使用',
            duration: 2500,
            location: 'middle'
        });
      }

    }
    function fuLianXuQianDao(){
      var token = $api.getStorage('token');
      if (token) {
        var  uri = '/user';
          api.ajax({
              url: host + apiUri + uri,
              method: 'get',
              dataType: 'json',
              timeout:10,
              headers: {
                  "source": api.systemType,
                  "version": version,
                  "session": token,
              },
          }, function(ret, err) {
            if(ret){
              // console.log(JSON.stringify(ret));
              if (ret.status == 200) {
                  var stylelist = $api.byId('lianxuqiandao');
                  var html ='已连续签到 '+ ret.data.sign_count +' 天';
                  $api.html(stylelist, html);
              } else {
                  netMessage(ret);
              }
            }else{
              // console.log(JSON.stringify(err));
              netWork(err);
            }
          });
      }

    }

    // 初始化事件监听
    function initEventListenner() {
        // 拦截Android的返回键，在首页点击返回键，提示退出应用
        api.addEventListener({
            name: 'keyback'
        }, function(ret, err) {
            api.confirm({
                title: '提示',
                msg: '是否退出应用',
                buttons: ['确定', '取消']
            }, function(ret, err) {
                if (ret.buttonIndex == 1) {
                    // 关闭当前的主Widget，就可以实现推出APP的效果
                    api.closeWidget({
                        silent: true, //直接退出，无需提示
                    });
                }
            });
        });
    }

    function fnAlert() {
        api.actionSheet({
            // title: '底部弹出框测试',
            cancelTitle: "",
            // destructiveTitle: '红色警告按钮',
            // buttons: ['我的作品','我的草稿', '取消']
            buttons: ['我的作品', '我的草稿']
        }, function(ret, err) {
            // alert(JSON.stringify(ret));
            var index = ret.buttonIndex;
            if (index == 1) {
                // alert(1);
                api.openWin({
                    name: 'personal',
                    url: './html/personal.html',
                    pageParam: {
                        name: 'test'
                    }
                });
                return;
            } else if (index == 2) {
                api.openWin({
                    name: 'cgxwin',
                    url: './html/cgxwin.html',
                    pageParam: {
                        name: 'test'
                    }
                });
            } else {
                // alert(3);
                return false;
            }
            // alert(JSON.stringify(index));

        });
    }

    function OpenSearch() {

        api.openWin({
            name: 'searchs_pre',
            url: './html/searchs_pre.html',
            pageParam: {
                name: 'test'
            }
        });

    }
    // 未读消息数
    function fnNum() {
        var token = $api.getStorage('token');
        if (token) {
          api.ajax({
              url: host + apiUri + '/message/unread_message_nums',
              method: 'get',
              dataType: 'json',
              timeout:10,
              headers: {
                  "source": api.systemType,
                  "version": version,
                  "session": token,
              }
          },function(ret, err){
              if (ret) {
                  // console.log(JSON.stringify(ret));
                  if (ret.status = 200) {
                    var message = ret.data.message;
                    var comment = ret.data.comment;
                    var notify = ret.data.notify;
                    var total = message + comment + notify;
                    var num = $api.byId('num');
                    if (total == 'NaN') {
                      var htmlnum = ''
                      $api.html(num, htmlnum);
                    } else if (total == 0) {
                      var htmlnum = ''
                      $api.html(num, htmlnum);
                    }else if (!total == 'NaN') {
                      var htmlnum = '<p>'+total+'</p>'
                      $api.html(num, htmlnum);
                    }
                  }else {
                    netMessage(ret);
                  }
              } else {
                // console.log(JSON.stringify(err));
                netWork(err);
              }
          });
        }


    }
</script>
